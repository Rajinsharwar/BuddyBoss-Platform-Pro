window.bp=window.bp||{},window.Backbone=window.Backbone||[],function(e){bp.Pusher_FrontCommon={pusher:{},typer_data:{},xhr:!1,can_type:!0,throttleTime:6e3,clearInterval:6e3,clearTimerId:[],pendingRemoves:[],leaveWaitingTime:5e3,pusherPresenceThread:[],chunks_event:[],bb_pusher_channels:[],start:function(){"undefined"!=typeof bb_pusher_vars&&void 0!==bb_pusher_vars.loggedin_user_id&&0!==parseInt(bb_pusher_vars.loggedin_user_id)&&(this.setupGlobals(),this.addListeners(),e(document).on("ready",function(){bp.Pusher_FrontCommon.setupToast()}))},setupGlobals:function(){bp.Pusher_FrontCommon.typer_data=[],bb_pusher_vars.current_thread_recipients_count=0,bb_pusher_vars.current_thread_group_id=0,bp.Pusher_FrontCommon.pusher=this.pusherGlobalObject(),bp.Pusher_FrontCommon.pusher&&void 0!==bp.Pusher_FrontCommon.pusher.channels&&"on"===bb_pusher_vars.is_live_messaging_enabled&&(bp.Pusher_FrontCommon.bb_pusher_channels.push("private-bb-pro-global"),bp.Pusher_FrontCommon.bb_pusher_channels.push("private-bb-user-"+bb_pusher_vars.loggedin_user_id),0<Object.keys(bb_pusher_vars.group_threads).length&&e.each(bb_pusher_vars.group_threads,function(e,r){bp.Pusher_FrontCommon.bb_pusher_channels.push("private-bb-message-thread-"+r)}),bp.Pusher_FrontCommon.pusherLiveMessage()),bp.Pusher_FrontCommon.bb_pusher_channels.forEach(function(e){var r;"private-bb-pro-global"===e?bp.Pusher_FrontCommon.pusherGlobalChannel(e):-1<e.search("private-bb-message-thread-")?(r=e.replace("private-bb-message-thread-",""),bp.Pusher_FrontCommon.pusherSubscribeThreadsChannels(parseInt(r))):-1<e.search("private-bb-user-")&&bp.Pusher_FrontCommon.pusherSubscribeUserChannel(e)})},addListeners:function(){e(document).ajaxSuccess(function(r,n,t){var a,s,i,o,d="";bp.Pusher_FrontCommon.pusher&&void 0!==bp.Pusher_FrontCommon.pusher.channels&&"on"===bb_pusher_vars.is_live_messaging_enabled&&(t.hasOwnProperty("data")&&"string"==typeof t.data&&-1<t.data.search("action=messages_get_user_message_threads")&&void 0!==n.responseText&&(!0!==(d=e.parseJSON(n.responseText)).success||!d.data||0<(a=d.data.threads).length&&a.forEach(function(e){bp.Pusher_FrontCommon.pusherSubscribeThreadsChannels(parseInt(e.id))})),t.hasOwnProperty("url")&&"string"==typeof t.url&&-1<t.url.search("action=buddyboss_theme_get_header_unread_messages")&&void 0!==n.responseText&&"on"===bb_pusher_vars.is_live_messaging_enabled&&!0===(d=e.parseJSON(n.responseText)).success&&d.data&&""!=(s=d.data.contents)&&((i=document.createElement("div")).innerHTML=s,0<(o=e(i).find("li")).length&&e.each(o,function(r,n){var t=e(n).attr("data-thread-id");bp.Pusher_FrontCommon.pusherSubscribeThreadsChannels(parseInt(t))}),i.remove()))})},setupToast:function(){var e=bp.Pusher_FrontCommon,r=e.readCookie("bb-thread-delete");r&&(jQuery(document).trigger("bb_trigger_toast_message",["",r,"warning",null,!0]),e.createCookie("bb-thread-delete","",-1));var n=e.readCookie("bb-message-component-disabled");n&&(jQuery(document).trigger("bb_trigger_toast_message",["",n,"warning",null,!0]),e.createCookie("bb-message-component-disabled","",-1));var t=e.readCookie("bb-message-group-thread-deleted");t&&(jQuery(document).trigger("bb_trigger_toast_message",["",t,"info",null,!0]),e.createCookie("bb-message-group-thread-deleted","",-1))},pusherGlobalObject:function(){var e={params:{bb_pusher_user_id:bb_pusher_vars.loggedin_user_id,bb_pusher_user_data:bb_pusher_vars.user_data,alien_hash:bb_pusher_vars.alien_hash}};return new Pusher(bb_pusher_vars.app_key,{authorizer:PusherBatchAuthorizer,cluster:bb_pusher_vars.app_cluster,authEndpoint:bb_pusher_vars.auth_endpoint,auth:e})},pusherGlobalChannel:function(r){bb_pusher_vars.global_channel=bp.Pusher_FrontCommon.pusher.subscribe(r),bb_pusher_vars.global_channel.bind("pusher:subscription_succeeded",function(){}),bb_pusher_vars.global_channel.bind("pusher:subscription_error",function(){}),bp.Pusher_FrontCommon.pusherModeration(bb_pusher_vars.global_channel),bp.Pusher_FrontCommon.pusherComponents(bb_pusher_vars.global_channel),bp.Pusher_FrontCommon.pusherSettingsUpdate(bb_pusher_vars.global_channel),bb_pusher_vars.global_channel.bind("client-bb-pro-message-access-control-update",function(){var e;bb_pusher_vars.current_thread_recipients_count<=1&&"no"===bb_pusher_vars.is_admin&&(e=new Date().getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+bb_pusher_vars.current_thread_id+"/?hash="+e,{trigger:!0})),void 0!==window.Backbone.trigger&&"no"===bb_pusher_vars.is_admin&&window.Backbone.trigger("relistelements")}),bb_pusher_vars.global_channel.bind("client-bb-pro-message-is-connected",function(){var e;0<parseInt(bb_pusher_vars.current_thread_id)&&"no"===bb_pusher_vars.is_admin&&(e=new Date().getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+bb_pusher_vars.current_thread_id+"/?hash="+e,{trigger:!0})),void 0!==window.Backbone.trigger&&"no"===bb_pusher_vars.is_admin&&window.Backbone.trigger("relistelements")}),bb_pusher_vars.global_channel.bind("client-bb-pro-update-group-messages",function(r){var n,t,a;parseInt(r.previous)!==parseInt(r.updated)&&(bb_pusher_vars.current_thread.is_group_thread&&!0===bb_pusher_vars.current_thread.is_group_thread&&(n=new Date().getTime(),parseInt(a=(t=e(".message-lists .thread-item:first-child")).find(".bp-message-link").attr("data-thread-id"))===parseInt(bb_pusher_vars.current_thread_id)&&(a=t.next(".thread-item").find(".bp-message-link").attr("data-thread-id")),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+a+"/?hash="+n,{trigger:!0})),0===parseInt(r.updated)&&jQuery(document).trigger("bb_trigger_toast_message",["",bb_pusher_vars.i18n.group_message_disabled,"warning",null,!0]),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"),void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow())})},pusherSubscribeUserChannel:function(r){bb_pusher_vars.user_channel=bp.Pusher_FrontCommon.pusher.subscribe(r),bb_pusher_vars.user_channel.bind("pusher:subscription_succeeded",function(){}),bb_pusher_vars.user_channel.bind("pusher:subscription_error",function(){}),bb_pusher_vars.user_channel.bind("client-bb-pro-member-connection-requested",function(r){var n,t;bp.Nouveau.updateUserPresence(parseInt(r.friend_user_id),"online"),parseInt(bb_pusher_vars.loggedin_user_id)===parseInt(r.friend_user_id)&&(n=r.thread_ids,t=[],0<n.length&&e.each(n,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&t.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),0<t.length&&e.each(t,function(e,r){var n;parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(n=new Date().getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+n,{trigger:!0}))}))}),bb_pusher_vars.user_channel.bind("client-bb-pro-member-withdrawn-connection-request",function(r){var n,t;bp.Nouveau.updateUserPresence(parseInt(r.friend_user_id),"online"),parseInt(bb_pusher_vars.loggedin_user_id)===parseInt(r.friend_user_id)&&(n=r.thread_ids,t=[],0<n.length&&e.each(n,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&t.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),0<t.length&&e.each(t,function(e,r){var n;parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(n=new Date().getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+n,{trigger:!0}))}))}),bb_pusher_vars.user_channel.bind("client-bb-pro-member-accepted-connection-request",function(r){var n=r.thread_ids,t=[];bp.Nouveau.updateUserPresence(parseInt(r.initiator_user_id),"online"),0<n.length&&e.each(n,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&t.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),0<t.length&&e.each(t,function(e,r){var n;parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(n=new Date().getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+n,{trigger:!0}))}),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements")}),bb_pusher_vars.user_channel.bind("client-bb-pro-member-rejected-connection-request",function(r){var n=r.thread_ids,t=[],a=new Date().getTime();bp.Nouveau.updateUserPresence(parseInt(r.initiator_user_id),"online"),0<n.length&&e.each(n,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&t.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),0<t.length&&e.each(t,function(e,r){parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(a=new Date().getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+a,{trigger:!0})),parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(a=new Date().getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+a,{trigger:!0}))}),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements")}),bb_pusher_vars.user_channel.bind("client-bb-pro-member-blocked",function(r){var n,t,a,s;bp.Nouveau.updateUserPresence(parseInt(r.creator_id),"online"),"on"===bb_pusher_vars.is_live_messaging_enabled&&(r.creator_id&&parseInt(r.creator_id)===parseInt(bb_pusher_vars.loggedin_user_id)||r.blocked_id&&parseInt(r.blocked_id)===parseInt(bb_pusher_vars.loggedin_user_id))&&(n=r.thread_ids,t=[],0<n.length&&e.each(n,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&t.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),0<t.length&&(e.each(t,function(e,r){var n;parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(n=new Date().getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+n,{trigger:!0}))}),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"))),"on"===bb_pusher_vars.is_live_messaging_enabled&&(r.creator_id&&parseInt(r.creator_id)===parseInt(bb_pusher_vars.loggedin_user_id)||r.blocked_id&&parseInt(r.blocked_id)===parseInt(bb_pusher_vars.loggedin_user_id))&&(r.blocked_id&&parseInt(r.blocked_id)===parseInt(bb_pusher_vars.loggedin_user_id)&&(a="",e.each(bb_pusher_vars.blocked_users_ids,function(e,n){parseInt(r.blocked_id)===parseInt(n.id)&&(a=e)}),""!==a&&delete bb_pusher_vars.blocked_users_ids[a]),r.creator_id&&parseInt(r.creator_id)===parseInt(bb_pusher_vars.loggedin_user_id)&&(s="",e.each(bb_pusher_vars.is_blocked_by_users,function(e,n){parseInt(r.creator_id)===parseInt(n.id)&&(s=e)}),""!==s&&delete bb_pusher_vars.is_blocked_by_users[s]),void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow())}),bb_pusher_vars.user_channel.bind("client-bb-pro-member-unblocked",function(r){var n,t,a,s;bp.Nouveau.updateUserPresence(parseInt(r.creator_id),"online"),"on"===bb_pusher_vars.is_live_messaging_enabled&&(r.creator_id&&parseInt(r.creator_id)===parseInt(bb_pusher_vars.loggedin_user_id)||r.unblocked_id&&parseInt(r.unblocked_id)===parseInt(bb_pusher_vars.loggedin_user_id))&&(n=r.thread_ids,t=[],0<n.length&&e.each(n,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&t.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),0<t.length&&(e.each(t,function(e,r){var n;parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(n=new Date().getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+n,{trigger:!0}))}),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"))),"on"===bb_pusher_vars.is_live_messaging_enabled&&(a="",e.each(bb_pusher_vars.blocked_users_ids,function(e,n){parseInt(r.unblocked_id)===parseInt(n.id)&&(a=e)}),s="",e.each(bb_pusher_vars.is_blocked_by_users,function(e,n){parseInt(r.creator_id)===parseInt(n.id)&&(s=e)}),r.creator_id&&parseInt(r.creator_id)===parseInt(bb_pusher_vars.loggedin_user_id)&&r.unblocked_id&&""!==a&&delete bb_pusher_vars.blocked_users_ids[a],r.unblocked_id&&parseInt(r.unblocked_id)===parseInt(bb_pusher_vars.loggedin_user_id)&&r.creator_id&&""!==s&&delete bb_pusher_vars.is_blocked_by_users[s])}),bb_pusher_vars.user_channel.bind("client-bb-pro-group-message-group-update-notify",function(r){var n,t,a,s,i,o,d,u,h=r.action;""!==h&&(n=r.thread_id,t=0,a=r.sender_id,u="",bp.Nouveau.updateUserPresence(parseInt(a),"online"),void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[n]&&(t=parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[n])),"group_message_group_joined"===h||"group_message_group_un_ban"===h?(void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow(),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"),0<t&&parseInt(t)===parseInt(bb_pusher_vars.current_thread_id)&&(u=new Date().getTime(),bp.Nouveau.Messages.router.navigate("view/"+t+"/?hash="+u,{trigger:!0}))):"group_message_group_promoted"===h||"group_message_group_demoted"===h?0<t&&parseInt(t)===parseInt(bb_pusher_vars.current_thread_id)&&(u=new Date().getTime(),bp.Nouveau.Messages.router.navigate("view/"+t+"/?hash="+u,{trigger:!0})):"group_message_group_left"!==h&&"group_message_group_ban"!==h&&"groups_remove_member"!==h||(parseInt(a)===parseInt(bb_pusher_vars.loggedin_user_id)&&0<t&&(bp.Nouveau.Messages.threads.remove(bp.Nouveau.Messages.threads.get(t)),0<t&&bb_pusher_vars.bb_pro_pusher_thread_ids[n]&&delete bb_pusher_vars.bb_pro_pusher_thread_ids[n]),0<t&&t===parseInt(bb_pusher_vars.current_thread_id)&&(u=new Date().getTime(),parseInt(a)===parseInt(bb_pusher_vars.loggedin_user_id)?(parseInt(i=(s=e(".message-lists .thread-item:first-child")).find(".bp-message-link").attr("data-thread-id"))===t&&(i=s.next(".thread-item").find(".bp-message-link").attr("data-thread-id")),o=e(".single-message-thread-header .participants-name").text(),d="","group_message_group_left"===h?d=bb_pusher_vars.i18n.thread_left+o:"group_message_group_ban"===h?d=bb_pusher_vars.i18n.group_banned+o:"groups_remove_member"===h&&(d=bb_pusher_vars.i18n.remove_from_group+o),jQuery(document).trigger("bb_trigger_toast_message",["",d,"info",null,!0]),void 0!==i?(bb_pusher_vars.current_thread_id=parseInt(i),bp.Nouveau.Messages.router.navigate("view/"+i+"/?hash="+u,{trigger:!0})):(bb_pusher_vars.current_thread_id=0,bp.Nouveau.Messages.router.navigate("compose/",{trigger:!0}))):bp.Nouveau.Messages.router.navigate("view/"+t+"/?hash="+u,{trigger:!0})),parseInt(a)===parseInt(bb_pusher_vars.loggedin_user_id)&&(void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"),void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow())))}),bb_pusher_vars.user_channel.bind("client-bb-pro-new-group-message",function(r){var n=bp.Pusher_FrontCommon.json2array(r.recipients);setTimeout(function(){var t,a;void 0!==n&&-1!==e.inArray(bb_pusher_vars.alien_hash,n)&&(void(t=0)!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r.thread_id]&&(t=parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r.thread_id])),0<parseInt(t)?(a=new Date().getTime(),parseInt(t)===parseInt(bb_pusher_vars.current_thread_id)&&bp.Nouveau.Messages.router.navigate("view/"+t+"/?hash="+a,{trigger:!0}),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"),void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow()):void 0!==r.thread&&(bb_pusher_vars.group_threads[r.thread_id]=parseInt(r.thread),bp.Pusher_FrontCommon.pusherSubscribeThreadsChannels(parseInt(r.thread)),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements")))},500)}),bb_pusher_vars.user_channel.bind("client-bb-pro-new-thread-create",function(r){var n=r.thread_id,t=bp.Pusher_FrontCommon.json2array(r.recipients);setTimeout(function(){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0===bb_pusher_vars.bb_pro_pusher_thread_ids[n]&&void 0!==t&&-1!==e.inArray(bb_pusher_vars.alien_hash,t)&&(void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"),void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow())},500)})},pusherSubscribeThreadsChannels:function(e){var r="live_message_"+e;void 0===bb_pusher_vars[r]&&(bb_pusher_vars[r]=bp.Pusher_FrontCommon.pusher.subscribe("private-bb-message-thread-"+e),bp.Pusher_FrontCommon.pusherMessageListen(bb_pusher_vars[r]))},pusherLiveMessage:function(){void 0!==bb_pusher_vars.current_thread_id&&0<bb_pusher_vars.current_thread_id&&bp.Pusher_FrontCommon.pusherSubscribeThreadsChannels(bb_pusher_vars.current_thread_id),e(document).on("heartbeat-tick",function(r,n){void 0!==n.bb_pro_pusher_thread_ids&&(bb_pusher_vars.bb_pro_pusher_thread_ids=n.bb_pro_pusher_thread_ids),void 0!==n.blocked_users_ids&&(bb_pusher_vars.blocked_users_ids=n.blocked_users_ids),void 0!==n.suspended_users_ids&&(bb_pusher_vars.suspended_users_ids=n.suspended_users_ids),void 0!==n.is_blocked_by_users&&(bb_pusher_vars.is_blocked_by_users=n.is_blocked_by_users),void 0!==n.group_threads&&(bb_pusher_vars.group_threads=n.group_threads),void 0!==bb_pusher_vars.group_threads&&0<Object.keys(bb_pusher_vars.group_threads).length&&e.each(bb_pusher_vars.group_threads,function(e,r){bp.Pusher_FrontCommon.pusherSubscribeThreadsChannels(parseInt(r))})}),e(document).on("click","#message-threads .thread-item",bp.Pusher_FrontCommon.pusherUpdateChannel.bind(this)),e(document).on("click",".bp-messages-nav-panel #compose",bp.Pusher_FrontCommon.pusherCompose.bind(this)),e(document).on("keyup","#message_content",bp.Pusher_FrontCommon.pusherMessageTypingEvent.bind(this)),e(document).ajaxComplete(function(r,n,t){var a,s,i,o,d;t.hasOwnProperty("data")&&"string"==typeof t.data&&0<t.data.search("action=messages_send_reply")&&void 0!==n.responseText&&void 0!==(a=e.parseJSON(n.responseText)).data.type&&"error"===a.data.type&&(i={hash:(s=bp.Pusher_FrontCommon.bbParseParams(bb_pusher_vars.ajax_url+"?"+t.data)).hash,thread_id:s.thread_id,sender_id:parseInt(bb_pusher_vars.loggedin_user_id)},o="live_message_"+bb_pusher_vars.current_thread_id,bb_pusher_vars.current_thread_id&&parseInt(bb_pusher_vars.current_thread_id)===parseInt(s.thread_id)&&bb_pusher_vars[o]&&bb_pusher_vars[o].trigger("client-bb-pro-after-ajax-fail",i),d={hash:s.hash,actions:t.data,canceltext:bb_pusher_vars.cancel_text,notdeliveredtext:bb_pusher_vars.not_delivered_text,tryagaintext:bb_pusher_vars.try_again_text,thread_id:s.thread_id},bp.Pusher_FrontCommon.renderAjaxUpdateFailedMessage(d))}),e(document).ajaxSuccess(function(r,n,t){var a,s,i,o,d,u,h,g,c,m,l,p,b="";t.hasOwnProperty("data")&&"string"==typeof t.data&&-1<t.data.search("action=messages_get_thread_messages")&&void 0!==n.responseText&&!0===(a=e.parseJSON(n.responseText)).success&&a.data&&(s=parseInt(a.data.thread.id),bb_pusher_vars.current_thread=a.data,parseInt(bb_pusher_vars.current_thread_id)===s&&(s in bp.Pusher_FrontCommon.typer_data||(bp.Pusher_FrontCommon.typer_data[s]=[]),i=bp.Pusher_FrontCommon.typer_data[s].filter(function(e){return null!=e}),bp.Pusher_FrontCommon.singleThreadTypingIndicator(i),bp.Pusher_FrontCommon.threadListTypingIndicator(s,i),clearTimeout(bp.Pusher_FrontCommon.clearTimerId[s]),bp.Pusher_FrontCommon.clearTimerId[s]=setTimeout(function(){parseInt(s)===parseInt(bb_pusher_vars.current_thread_id)&&bp.Pusher_FrontCommon.singleThreadTypingIndicator([]),bp.Pusher_FrontCommon.threadListTypingIndicator(s,[])},bp.Pusher_FrontCommon.clearInterval)),bb_pusher_vars.current_thread_recipients_count=a.data.thread.recipients.current_count,bb_pusher_vars.current_thread_group_id=""!==a.data.group_id?parseInt(a.data.group_id):0,0===parseInt(bb_pusher_vars.current_thread_id)&&s&&(bb_pusher_vars.current_thread_id=s)),t.hasOwnProperty("data")&&"string"==typeof t.data&&-1<t.data.search("action=messages_get_user_message_threads")&&void 0!==n.responseText&&(!(o=e.parseJSON(n.responseText)).data.threads||0<(d=o.data.threads).length&&d.forEach(function(e){var r=parseInt(e.id);r in bp.Pusher_FrontCommon.typer_data||(bp.Pusher_FrontCommon.typer_data[r]=[]);var n=bp.Pusher_FrontCommon.typer_data[r].filter(function(e){return null!=e});bp.Pusher_FrontCommon.singleThreadTypingIndicator(n),bp.Pusher_FrontCommon.threadListTypingIndicator(r,n),clearTimeout(bp.Pusher_FrontCommon.clearTimerId[r]),bp.Pusher_FrontCommon.clearTimerId[r]=setTimeout(function(){parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&bp.Pusher_FrontCommon.singleThreadTypingIndicator([]),bp.Pusher_FrontCommon.threadListTypingIndicator(r,[])},bp.Pusher_FrontCommon.clearInterval)})),t.hasOwnProperty("data")&&"string"==typeof t.data&&-1<t.data.search("action=messages_send_reply")&&void 0!==n.responseText&&(void 0!==(u=e.parseJSON(n.responseText)).data.type&&"error"===u.data.type?(g={hash:(h=bp.Pusher_FrontCommon.bbParseParams(bb_pusher_vars.ajax_url+"?"+t.data)).hash,thread_id:h.thread_id,sender_id:parseInt(bb_pusher_vars.loggedin_user_id)},b="live_message_"+bb_pusher_vars.current_thread_id,bb_pusher_vars.current_thread_id&&parseInt(bb_pusher_vars.current_thread_id)===parseInt(h.thread_id)&&bb_pusher_vars[b]&&bb_pusher_vars[b].trigger("client-bb-pro-after-ajax-fail",g),c={hash:h.hash,actions:t.data,canceltext:bb_pusher_vars.cancel_text,notdeliveredtext:bb_pusher_vars.not_delivered_text,tryagaintext:bb_pusher_vars.try_again_text,thread_id:h.thread_id},bp.Pusher_FrontCommon.renderAjaxUpdateFailedMessage(c)):(m={hash:u.data.hash,message:u.data.messages[0],recipient_inbox_unread_counts:u.data.recipient_inbox_unread_counts,thread_id:u.data.thread_id},bp.Pusher_FrontCommon.renderAjaxUpdateMessage(m),bp.Pusher_FrontCommon.bb_update_header_messages())),t.hasOwnProperty("data")&&"string"==typeof t.data&&-1<t.data.search("action=messages_delete")&&void 0!==n.responseText&&(void 0!==(l=e.parseJSON(n.responseText)).data.recipient_inbox_unread_counts&&bp.Pusher_FrontCommon.updateInboxMessageUnreadCount(bp.Pusher_FrontCommon.json2array(l.data.recipient_inbox_unread_counts)),bp.Pusher_FrontCommon.bb_update_header_messages()),t.hasOwnProperty("data")&&"string"==typeof t.data&&-1<t.data.search("action=heartbeat")&&0<bb_pusher_vars.bb_pro_pusher_thread_ids.length&&bb_pusher_vars.bb_pro_pusher_thread_ids.forEach(function(e){var r;(e=parseInt(e))===parseInt(bb_pusher_vars.current_thread_id)&&(e in bp.Pusher_FrontCommon.typer_data||(bp.Pusher_FrontCommon.typer_data[e]=[]),r=bp.Pusher_FrontCommon.typer_data[e].filter(function(e){return null!=e}),bp.Pusher_FrontCommon.singleThreadTypingIndicator(r),bp.Pusher_FrontCommon.threadListTypingIndicator(e,r),clearTimeout(bp.Pusher_FrontCommon.clearTimerId[e]),bp.Pusher_FrontCommon.clearTimerId[e]=setTimeout(function(){parseInt(e)===parseInt(bb_pusher_vars.current_thread_id)&&bp.Pusher_FrontCommon.singleThreadTypingIndicator([]),bp.Pusher_FrontCommon.threadListTypingIndicator(e,[])},bp.Pusher_FrontCommon.clearInterval))}),t.hasOwnProperty("data")&&"string"==typeof t.data&&(-1<t.data.search("action=messages_unread")||-1<t.data.search("action=messages_read"))&&void 0!==n.responseText&&void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow(),t.hasOwnProperty("data")&&"string"==typeof t.data&&-1<t.data.search("action=messages_hide_thread")&&void 0!==n.responseText&&void 0!==bp.Nouveau.Messages.threads&&(void 0!==bp.Nouveau.Messages.threads.length&&0<bp.Nouveau.Messages.threads.length?bb_pusher_vars.current_thread_id=bp.Nouveau.Messages.threads.at(0).id:bb_pusher_vars.current_thread_id=0),t.hasOwnProperty("data")&&"string"==typeof t.data&&-1<t.data.search("action=groups_join_group")&&void 0!==n.responseText&&void 0!==(p=e.parseJSON(n.responseText)).success&&!0===p.success&&bp.Pusher_FrontCommon.bb_update_header_messages()}),e(document).ajaxError(function(e,r,n){var t,a,s,i;n.hasOwnProperty("data")&&"string"==typeof n.data&&0<n.data.search("action=messages_send_reply")&&(a={hash:(t=bp.Pusher_FrontCommon.bbParseParams(bb_pusher_vars.ajax_url+"?"+n.data)).hash,thread_id:t.thread_id,sender_id:parseInt(bb_pusher_vars.loggedin_user_id)},s="live_message_"+bb_pusher_vars.current_thread_id,bb_pusher_vars.current_thread_id&&parseInt(bb_pusher_vars.current_thread_id)===parseInt(t.thread_id)&&bb_pusher_vars[s]&&bb_pusher_vars[s].trigger("client-bb-pro-after-ajax-fail",a),i={hash:t.hash,actions:n.data,canceltext:bb_pusher_vars.cancel_text,notdeliveredtext:bb_pusher_vars.not_delivered_text,tryagaintext:bb_pusher_vars.try_again_text,thread_id:t.thread_id},bp.Pusher_FrontCommon.renderAjaxUpdateFailedMessage(i))}),e(document).ajaxSend(function(r,n,t){var a,s,i,o,d,u,h,g,c,m,l,p,b,v,f,$,C,y;t.hasOwnProperty("data")&&"string"==typeof t.data&&0<t.data.search("action=messages_send_reply")&&(a=bp.Pusher_FrontCommon.bb_unserialize(t.data),s=[],i=[],o=[],d=[],u=[],h={},g=window.deparam(t.data),c='<div class="message_send_sending"><span class="info-text-send-message">'+bb_pusher_vars.sending_text+"</span></div>",delete a.nonce,delete a.action,e.each(a,function(e){(-1<e.search("media")||-1<e.search("video")||-1<e.search("document")||-1<e.search("gif_data"))&&delete a[e]}),void 0!==g.media&&g.media&&(g.media.forEach(function(e){var r=e.thumb;void 0!==e.js_preview&&(r=e.js_preview);var n=null,t=null;1===g.media.length&&(n=e.image_h,t=e.image_w),s.push({id:e.id,attachment_id:e.id,full:e.url,privacy:e.privacy,thumbnail:e.msg_url||e.medium||e.thumb,title:e.name,height:n,width:t,menu_order:parseInt(e.menu_order)}),i.push({id:e.id,attachment_id:e.id,full:e.url,privacy:e.privacy,thumbnail:r,title:e.name,height:n,width:t,menu_order:parseInt(e.menu_order)})}),1<s.length&&s.sort(function(e,r){return e.menu_order-r.menu_order}),1<i.length&&i.sort(function(e,r){return e.menu_order-r.menu_order})),void 0!==g.video&&g.video&&(g.video.forEach(function(e){void 0===e.js_preview&&(e.js_preview=bb_pusher_vars.video_default_url),d.push({id:e.id,attachment_id:e.id,full:e.url,privacy:e.privacy,thumbnail:bb_pusher_vars.video_default_url,title:e.name,vid_ids_fake:e.vid_msg_url,ext:e.ext,menu_order:parseInt(e.menu_order)}),u.push({id:e.id,attachment_id:e.id,full:e.url,privacy:e.privacy,thumbnail:e.js_preview,title:e.name,vid_ids_fake:e.vid_msg_url,ext:e.ext,menu_order:parseInt(e.menu_order)})}),1<d.length&&d.sort(function(e,r){return e.menu_order-r.menu_order}),1<u.length&&u.sort(function(e,r){return e.menu_order-r.menu_order})),void 0!==g.document&&g.document&&(g.document.forEach(function(e){o.push({id:e.id,attachment_id:e.id,full:e.url,privacy:e.privacy,thumbnail:"",title:e.name,url:e.url,svg_icon:e.svg_icon,extension:e.extension,author:"",preview:"",full_preview:"",text_preview:"",mp3_preview:"",document_title:e.name,mirror_text:"",size:e.size,extension_description:"",download_text:"",download:"",copy_download_link:"",msg_preview:"",menu_order:parseInt(e.menu_order)})}),1<o.length&&o.sort(function(e,r){return e.menu_order-r.menu_order})),void 0!==g.gif_data&&g.gif_data&&(m="",void 0!==g.gif_data.images["480w_still"].url&&(m=g.gif_data.images["480w_still"].url),h.video_url=g.gif_data.images.original_mp4.mp4,h.preview_url=m),p=Object.fromEntries(l=new URLSearchParams(t.data)),b=(b=e.trim(e("<p>"+p.content+"<p>").text())).replace(/&nbsp;/g," "),$=v=void 0!==a.hash?a.hash:new Date().getTime(),C=f=""===b?"":p.content,void 0!==g.resend&&($=v+" sending",C+=c),(s||d||o)&&($+=" has-medias"),a.id=v,a.sender_id=bb_pusher_vars.loggedin_user_id,a.sender_name=bb_pusher_vars.loggedin_user_name,a.gif=h,a.is_user_suspended="true"===a.is_user_suspended,a.is_user_blocked="true"===a.is_user_blocked,a.is_user_deleted="true"===a.is_user_deleted,a.sender_avatar=bb_pusher_vars.sender_avatar,a.sender_link=bb_pusher_vars.sender_link,a.display_date=bp.Pusher_FrontCommon.getWPCurrentTime(),a.className=$,a.sender_is_you=!0,a.thread_id=bb_pusher_vars.current_thread_id,a.content=C,a.excerpt="",C&&(a.excerpt=C.replace(/(<br\s*?\/?>|<\/(\w+)><(\w+)>)/g," ").replace(/(<([^>]+)>)/gi,"").replace(/\s+/g," "),75<a.excerpt.length&&(a.excerpt=a.excerpt.substring(0,75)+"...")),a.media=s,a.video=d,a.document=o,a.is_group=!1,void 0!==bb_pusher_vars.current_thread.group_id&&0<parseInt(bb_pusher_vars.current_thread.group_id)&&(a.is_group=!0),void 0!==g.resend?bp.Pusher_FrontCommon.renderUpdateSendingMessage(a):(a.media=i,a.video=u,bp.Pusher_FrontCommon.renderMessage(a)),a.media=s,a.video=d,a.has_media=!1,(0<s.length||0<d.length||0<o.length||void 0!==h.video_url&&void 0!==h.preview_url)&&(a.has_media=!0),y="live_message_"+bb_pusher_vars.current_thread_id,a.content=f,bb_pusher_vars[y]&&(a.sender_is_you=!1,bp.Pusher_FrontCommon.triggerPusherChunked(bb_pusher_vars[y],"client-bb-pro-before-message-ajax-send",a)),e("#messages-media-button").length&&e("#messages-media-button").removeClass("active"),e("#messages-video-button").length&&e("#messages-video-button").removeClass("active"),e("#messages-document-button").length&&e("#messages-document-button").removeClass("active"),e("#messages-gif-button").length&&e("#messages-gif-button").removeClass("active"),e(window).trigger("scroll"))})},pusherMessageListen:function(r){r.bind("pusher:subscription_succeeded",function(){}),r.bind("pusher:subscription_error",function(){}),r.bind("client-bb-pro-before-message-ajax-send",function(e){var r;void 0!==e.sender_id&&(bp.Nouveau.updateUserPresence(parseInt(e.sender_id),"online"),void 0!==e.thread_id&&bp.Pusher_FrontCommon.threadTypingEnd(parseInt(e.thread_id),parseInt(e.sender_id))),void 0!==e.message_chunk_id?(bp.Pusher_FrontCommon.chunks_event.hasOwnProperty(e.message_chunk_id)||(bp.Pusher_FrontCommon.chunks_event[e.message_chunk_id]={chunks:[]}),(r=bp.Pusher_FrontCommon.chunks_event[e.message_chunk_id]).chunks[e.message_chunk_index]=e.message_chunk,e.message_chunk_final&&r.chunks.length===e.message_total_chunk&&(bp.Pusher_FrontCommon.renderMessage(JSON.parse(r.chunks.join(""))),delete bp.Pusher_FrontCommon.chunks_event[e.message_chunk_id])):bp.Pusher_FrontCommon.renderMessage(e),void 0!==window.Backbone.trigger&&void 0!==e.refresh_element&&!0===e.refresh_element&&window.Backbone.trigger("relistelements")}),bp.Pusher_FrontCommon.bindWithPusherChunking(r,"client-bb-pro-after-message-ajax-complete",function(r){r.message,bp.Pusher_FrontCommon.renderAjaxUpdateMessage(r),bp.Pusher_FrontCommon.updateInboxMessageUnreadCount(r.recipient_inbox_unread_counts),bp.Pusher_FrontCommon.UpdateThreadListing(r.recipient_inbox_unread_counts,r),bp.Pusher_FrontCommon.bb_update_header_messages(),e(window).trigger("scroll")}),r.bind("client-bb-pro-thread-delete-message",function(e){void 0!==window.Backbone.trigger&&void 0!==e.thread_id&&(window.Backbone.trigger("onMessageDeleteSuccess",e),bp.Pusher_FrontCommon.bb_update_header_messages())}),r.bind("client-bb-pro-after-ajax-fail",function(e){void 0!==window.Backbone.trigger&&void 0!==e.thread_id&&parseInt(e.thread_id)===parseInt(bb_pusher_vars.current_thread_id)&&window.Backbone.trigger("onMessageAjaxFail",e)}),r.bind("client-bb-pro-typing-start",function(e){var r,n=parseInt(e.thread_id),t=parseInt(e.user_id);bp.Nouveau.updateUserPresence(t,"online"),t!==parseInt(bb_pusher_vars.loggedin_user_id)&&(n in bp.Pusher_FrontCommon.typer_data||(bp.Pusher_FrontCommon.typer_data[n]=[]),t in bp.Pusher_FrontCommon.typer_data[n]||(bp.Pusher_FrontCommon.typer_data[n][t]=e.username),r=bp.Pusher_FrontCommon.typer_data[n].filter(function(e){return null!=e}),parseInt(n)===parseInt(bb_pusher_vars.current_thread_id)&&bp.Pusher_FrontCommon.singleThreadTypingIndicator(r),bp.Pusher_FrontCommon.threadListTypingIndicator(n,r),clearTimeout(bp.Pusher_FrontCommon.clearTimerId[n]),bp.Pusher_FrontCommon.clearTimerId[n]=setTimeout(function(){bp.Pusher_FrontCommon.threadTypingEnd(n,t)},bp.Pusher_FrontCommon.clearInterval))}),r.bind("client-bb-pro-typing-end",function(e){bp.Pusher_FrontCommon.threadTypingEnd(e.thread_id,e.user_id)}),r.bind("client-bb-pro-group-message-group-update-notify",function(r){var n,t,a,s,i,o,d,u,h=r.action;""!==h&&(n=r.thread_id,t=0,a=r.sender_id,u="",bp.Nouveau.updateUserPresence(parseInt(a),"online"),void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[n]&&(t=parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[n])),"group_message_group_joined"===h||"group_message_group_un_ban"===h?(void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow(),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"),0<t&&parseInt(t)===parseInt(bb_pusher_vars.current_thread_id)&&(u=new Date().getTime(),bp.Nouveau.Messages.router.navigate("view/"+t+"/?hash="+u,{trigger:!0}))):"group_message_group_promoted"===h||"group_message_group_demoted"===h?0<t&&parseInt(t)===parseInt(bb_pusher_vars.current_thread_id)&&(u=new Date().getTime(),bp.Nouveau.Messages.router.navigate("view/"+t+"/?hash="+u,{trigger:!0})):"group_message_group_left"!==h&&"group_message_group_ban"!==h&&"groups_remove_member"!==h||(parseInt(a)===parseInt(bb_pusher_vars.loggedin_user_id)&&0<t&&(bp.Nouveau.Messages.threads.remove(bp.Nouveau.Messages.threads.get(t)),0<t&&bb_pusher_vars.bb_pro_pusher_thread_ids[n]&&delete bb_pusher_vars.bb_pro_pusher_thread_ids[n]),0<t&&t===parseInt(bb_pusher_vars.current_thread_id)&&(u=new Date().getTime(),parseInt(a)===parseInt(bb_pusher_vars.loggedin_user_id)?(parseInt(i=(s=e(".message-lists .thread-item:first-child")).find(".bp-message-link").attr("data-thread-id"))===t&&(i=s.next(".thread-item").find(".bp-message-link").attr("data-thread-id")),o=e(".single-message-thread-header .participants-name").text(),d="","group_message_group_left"===h?d=bb_pusher_vars.i18n.thread_left+o:"group_message_group_ban"===h?d=bb_pusher_vars.i18n.group_banned+o:"groups_remove_member"===h&&(d=bb_pusher_vars.i18n.remove_from_group+o),jQuery(document).trigger("bb_trigger_toast_message",["",d,"info",null,!0]),void 0!==i?(bb_pusher_vars.current_thread_id=parseInt(i),bp.Nouveau.Messages.router.navigate("view/"+i+"/?hash="+u,{trigger:!0})):(bb_pusher_vars.current_thread_id=0,bp.Nouveau.Messages.router.navigate("compose/",{trigger:!0}))):bp.Nouveau.Messages.router.navigate("view/"+t+"/?hash="+u,{trigger:!0})),parseInt(a)===parseInt(bb_pusher_vars.loggedin_user_id)&&(void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"),void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow())))}),r.bind("client-bb-pro-group-thread-deleted",function(e){var r,n=e.thread_id,t=0;void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[n]&&(t=parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[n])),0<t&&t===parseInt(bb_pusher_vars.current_thread_id)?(r=e.group_name+bb_pusher_vars.i18n.deleted,1<bp.Nouveau.Messages.threads.length?(bp.Nouveau.Messages.threads.remove(parseInt(t)),bb_pusher_vars.current_thread_id=parseInt(bp.Nouveau.Messages.threads.at(0).id),bp.Nouveau.Messages.router.navigate("view/"+bb_pusher_vars.current_thread_id+"/",{trigger:!0})):(BP_Nouveau.messages.hasThreads=!1,bb_pusher_vars.current_thread_id=0,bp.Nouveau.Messages.router.navigate("compose/",{trigger:!0})),void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow(),jQuery(document).trigger("bb_trigger_toast_message",["",r,"info",null,!0])):(bp.Nouveau.Messages.threads.remove(parseInt(t)),void 0!==window.Backbone.trigger&&"no"===bb_pusher_vars.is_admin&&window.Backbone.trigger("relistelements"),void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow())}),r.bind("client-bb-pro-group-setting-update",function(r){var n,t=r.thread_id,a=0;void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[t]&&(a=parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[t])),0!==a&&bb_pusher_vars.current_thread_id===a&&"no"===bb_pusher_vars.is_admin&&-1!==e.inArray(bb_pusher_vars.alien_hash,r.member_ids)&&(n=new Date().getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+bb_pusher_vars.current_thread_id+"/?hash="+n,{trigger:!0}))}),r.bind("client-bb-pro-thread-delete",function(r){var n,t,a,s,i=r.thread_id,o=0,d=r.recipients;void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[i]&&(o=parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[i])),0!==parseInt(o)&&(parseInt(o)===parseInt(bb_pusher_vars.current_thread_id)?(t="",void 0!==r.group_name?(t=r.group_name+bb_pusher_vars.i18n.deleted,bp.Pusher_FrontCommon.createCookie("bb-message-group-thread-deleted",t,5)):(n=(n=bp.Pusher_FrontCommon.json2array(d).map(function(e){if(e.user_id!==bb_pusher_vars.alien_hash)return e.name})).filter(function(e){return null!=e}),t=wp.i18n.sprintf(bb_pusher_vars.i18n.conversion_delete,n.join(", ")),bp.Pusher_FrontCommon.createCookie("bb-thread-delete",t,5)),"undefined"!=typeof BP_Nouveau&&void 0!==BP_Nouveau.messages&&void 0!==BP_Nouveau.messages.message_url?window.location.href=BP_Nouveau.messages.message_url:window.location.reload()):(0<(a=e('#message-threads li .bp-message-link[data-thread-id="'+o+'"]')).length&&a.parents(".thread-item").remove(),0<(s=e('#header-messages-dropdown-elem li[data-thread-id="'+o+'"]')).length&&s.remove(),d[bb_pusher_vars.alien_hash]&&(d=bp.Pusher_FrontCommon.json2array(d),bp.Pusher_FrontCommon.updateInboxMessageUnreadCount(d),bp.Pusher_FrontCommon.bb_update_header_messages(),0<o&&bb_pusher_vars.bb_pro_pusher_thread_ids[i]&&delete bb_pusher_vars.bb_pro_pusher_thread_ids[i])))})},threadTypingEnd:function(e,r){var n=parseInt(e),t=parseInt(r);bp.Nouveau.updateUserPresence(t,"online"),n in bp.Pusher_FrontCommon.typer_data||(bp.Pusher_FrontCommon.typer_data[n]=[]),r in bp.Pusher_FrontCommon.typer_data[n]&&delete bp.Pusher_FrontCommon.typer_data[n][t];var a=bp.Pusher_FrontCommon.typer_data[n].filter(function(e){return null!=e});parseInt(n)===parseInt(bb_pusher_vars.current_thread_id)&&bp.Pusher_FrontCommon.singleThreadTypingIndicator(a),bp.Pusher_FrontCommon.threadListTypingIndicator(n,a)},singleThreadTypingIndicator:function(r){var n;0<r.length&&e(".bp-messages-content .bp-messages-notice").find(".bp-user-messages-feedback").length<1?(n=r.length+bb_pusher_vars.i18n.two_typing,1===r.length?n="<strong>"+r.join("</strong>, <strong>")+"</strong>"+bb_pusher_vars.i18n.single_typing:2===r.length?n="<strong>"+r.join("</strong>"+bb_pusher_vars.i18n.separator+"<strong>")+"</strong>"+bb_pusher_vars.i18n.typing:2<r.length&&(n="<strong>"+r[0]+"</strong>"+bb_pusher_vars.i18n.separator+(r.length-1)+bb_pusher_vars.i18n.multiple_typing),e(".bb-pusher-typing-indicator .bb-pusher-typing-indicator-text-inner").html(n),e(".bb-pusher-typing-indicator").removeClass("bp-hide")):e(".bb-pusher-typing-indicator").addClass("bp-hide")},threadListTypingIndicator:function(r,n){var t,a=e('#message-threads li .bp-message-link[data-thread-id="'+r+'"]');0<n.length&&(0===e(".bp-messages-notice").find(".bp-user-messages-feedback").length||"unarchived"!==bp.Nouveau.Messages.threadType)?(t=n.length+bb_pusher_vars.i18n.two_typing,1===n.length&&(t=n.join(", ")+bb_pusher_vars.i18n.single_typing),a.find(".typing-indicator").html(t).removeClass("bp-hide"),a.find(".thread-excerpt").addClass("bp-hide")):(a.find(".typing-indicator").html("").addClass("bp-hide"),a.find(".thread-excerpt").removeClass("bp-hide"));var s,i=e('#header-messages-dropdown-elem li[data-thread-id="'+r+'"]');0<i.length&&(0<n.length&&0===e(".bp-messages-notice").find(".bp-user-messages-feedback").length?(s=n.length+bb_pusher_vars.i18n.two_typing,1===n.length&&(s=n.join(", ")+bb_pusher_vars.i18n.single_typing),i.find(".typing-indicator").html(s).removeClass("bp-hide"),i.find(".posted").addClass("bp-hide")):(i.find(".typing-indicator").html("").addClass("bp-hide"),i.find(".posted").removeClass("bp-hide")))},pusherUpdateChannel:function(r){var n;e(r.currentTarget).hasClass("optionsOpen")||(n=e(r.currentTarget).find(".bp-message-link").data("thread-id"))&&(bb_pusher_vars.current_thread_id=parseInt(n),bb_pusher_vars.thread_channel="private-bb-message-thread-"+n,0!==parseInt(n)&&-1!==e.inArray(parseInt(n),bb_pusher_vars.bb_pro_pusher_thread_ids)&&bp.Pusher_FrontCommon.pusherSubscribeThreadsChannels(n))},pusherCompose:function(){bb_pusher_vars.current_thread_id=0,bb_pusher_vars.thread_channel=""},pusherMessageTypingEvent:function(r){var n,t,a,s=e(r.currentTarget).text();0!==parseInt(bb_pusher_vars.current_thread_id)&&13!==r.keyCode&&9!==r.keyCode&&16!==r.keyCode&&(n="live_message_"+bb_pusher_vars.current_thread_id,(t=document.createElement("div")).innerHTML=s,a=t.textContent||t.innerText||"",setTimeout(function(){""!==a&&bb_pusher_vars[n]?bp.Pusher_FrontCommon.can_type&&(bp.Pusher_FrontCommon.can_type=!1,bb_pusher_vars[n].trigger("client-bb-pro-typing-start",{username:bb_pusher_vars.loggedin_user_name,user_id:bb_pusher_vars.loggedin_user_id,thread_id:bb_pusher_vars.current_thread_id}),setTimeout(function(){bp.Pusher_FrontCommon.can_type=!0},bp.Pusher_FrontCommon.throttleTime)):""===a&&bb_pusher_vars[n]&&(bp.Pusher_FrontCommon.can_type=!0,bb_pusher_vars[n].trigger("client-bb-pro-typing-end",{username:bb_pusher_vars.loggedin_user_name,user_id:bb_pusher_vars.loggedin_user_id,thread_id:bb_pusher_vars.current_thread_id}))},300))},pusherModeration:function(r){r.bind("client-bb-pro-member-suspended",function(r){var n,t;r.user_id&&void(bb_pusher_vars.suspended_users_ids[r.user_id]=0)!==window.wp.heartbeat&&window.wp.heartbeat.connectNow(),r.user_id===bb_pusher_vars.alien_hash?window.location.reload():(n=r.thread_ids,t=[],0<n.length&&e.each(n,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&t.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),0<t.length&&(e.each(t,function(e,r){var n;parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(n=new Date().getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+n,{trigger:!0}))}),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements")))}),r.bind("client-bb-pro-member-deleted",function(r){var n,t;r.user_id===bb_pusher_vars.alien_hash?window.location.reload():(n=r.thread_ids,t=[],0<n.length&&e.each(n,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&t.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),0<t.length&&(e.each(t,function(e,r){var n;parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(n=new Date().getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+n,{trigger:!0}))}),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements")))}),r.bind("client-bb-pro-member-unsuspended",function(r){var n=r.thread_ids,t=[];0<n.length&&e.each(n,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&t.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),r.user_id&&void 0!==bb_pusher_vars.suspended_users_ids[r.user_id]&&delete bb_pusher_vars.suspended_users_ids[r.user_id],0<t.length&&(e.each(t,function(e,r){var n;parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(n=new Date().getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+n,{trigger:!0}))}),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"))})},pusherComponents:function(r){r.bind("client-bb-pro-active-components",function(r){var n,t=r.previous,a=r.updated;t.messages&&void 0===a.messages&&(void 0!==bb_pusher_vars.current_thread_id?(n=bb_pusher_vars.i18n.disabled_private_message,bp.Pusher_FrontCommon.createCookie("bb-message-component-disabled",n,5),window.location.href=bb_pusher_vars.home_url):(e(document.body).find(".bb-message-dropdown-notification").length&&e(document.body).find(".bb-message-dropdown-notification").remove(),e(document.body).find(".bp-messages-nav").length&&e(document.body).find(".bp-messages-nav").remove(),e(document.body).find(".bp-compose-messages-nav").length&&e(document.body).find(".bp-compose-messages-nav").remove(),e(document.body).find(".bp-inbox-sub-nav").length&&e(document.body).find(".bp-inbox-sub-nav").remove(),e(document.body).find("#wp-admin-bar-my-account-messages").length&&e(document.body).find("#wp-admin-bar-my-account-messages").remove(),e(document.body).find(".header-aside-inner #wp-admin-bar-my-account-messages").length&&e(document.body).find(".header-aside-inner #wp-admin-bar-my-account-messages").remove()))})},pusherSettingsUpdate:function(e){e.bind("client-bb-pro-pusher-settings-change",function(){window.location.reload()})},bb_unserialize:function(e){e=encodeURIComponent(e);for(var r,n,t,a=decodeURI(e).split("&"),s={},i=0,o=a.length;i<o;i++)(t=(n=a[i].split("="))[0]).indexOf("[]")===t.length-2?(void 0===s[r=t.substring(0,t.length-2)]&&(s[r]=[]),s[decodeURIComponent(r)].push(decodeURIComponent(n[1]))):s[decodeURIComponent(t)]=decodeURIComponent(n[1]);return s},renderMessage:function(r){var n=[];r.is_deleted=0,r.is_new=!0,r.is_starred=!1,r.star_link="",r.date=new Date,void 0!==r.gif&&Object.keys(r.gif).length<1&&delete r.gif,void 0!==r.video&&r.video.length<1&&delete r.video,void 0!==r.document&&r.document.length<1&&delete r.document,void 0!==r.media&&r.media.length<1&&delete r.media,bp.Pusher_FrontCommon.threadTypingEnd(parseInt(r.thread_id),parseInt(r.sender_id));var t=[];Object.values(bb_pusher_vars.blocked_users_ids).forEach(function(e){t[parseInt(e.id)]=e}),0<t.length&&void 0!==t[parseInt(r.sender_id)]&&(r.is_user_blocked=!0,r.sender_name=t[parseInt(r.sender_id)].blocked_user_name,r.sender_avatar=t[parseInt(r.sender_id)].blocked_avatar_url,r.content=bb_pusher_vars.blocked_message_text,r.sender_link="",void 0!==r.gif&&delete r.gif,void 0!==r.video&&delete r.video,void 0!==r.document&&delete r.document,void 0!==r.media&&delete r.media),-1<e.inArray(parseInt(r.sender_id),bb_pusher_vars.suspended_users_ids)&&(r.is_user_suspended=!0,r.sender_name=bb_pusher_vars.suspended_avatar,r.sender_avatar=bb_pusher_vars.suspended_avatar,r.content=bb_pusher_vars.suspended_message_text,r.sender_link="",void 0!==r.gif&&delete r.gif,void 0!==r.video&&delete r.video,void 0!==r.document&&delete r.document,void 0!==r.media&&delete r.media);var a=[];Object.values(bb_pusher_vars.is_blocked_by_users).forEach(function(e){a[parseInt(e.id)]=e}),0<a.length&&void 0!==a[parseInt(r.sender_id)]&&(r.is_user_blocked_by=!0,r.sender_name=a[parseInt(r.sender_id)].blocked_user_name,r.sender_avatar=a[parseInt(r.sender_id)].blocked_avatar_url),n.push(r),void 0!==window.Backbone.trigger&&void 0!==r.thread_id&&parseInt(r.thread_id)===parseInt(bb_pusher_vars.current_thread_id)&&window.Backbone.trigger("onSentMessage",n)},renderAjaxUpdateMessage:function(r){var n=[];Object.values(bb_pusher_vars.blocked_users_ids).forEach(function(e){n[parseInt(e.id)]=e});var t=[];Object.values(bb_pusher_vars.is_blocked_by_users).forEach(function(e){t[parseInt(e.id)]=e}),void 0!==r.thread_id&&void 0!==r.message&&(0<n.length&&void 0!==n[parseInt(r.message.sender_id)]&&(r.message.is_user_blocked=!0,r.message.sender_name=n[parseInt(r.message.sender_id)].blocked_user_name,r.message.sender_avatar=n[parseInt(r.message.sender_id)].blocked_avatar_url,r.message.content=bb_pusher_vars.blocked_message_text,r.message.sender_link="",void 0!==r.message.gif&&delete r.message.gif,void 0!==r.message.video&&delete r.message.video,void 0!==r.message.document&&delete r.message.document,void 0!==r.message.media&&delete r.message.media),-1<e.inArray(parseInt(r.message.sender_id),bb_pusher_vars.suspended_users_ids)&&(r.message.is_user_suspended=!0,r.message.sender_name=bb_pusher_vars.suspended_avatar,r.message.sender_avatar=bb_pusher_vars.suspended_avatar,r.message.content=bb_pusher_vars.suspended_message_text,r.message.sender_link="",void 0!==r.message.gif&&delete r.message.gif,void 0!==r.message.video&&delete r.message.video,void 0!==r.message.document&&delete r.message.document,void 0!==r.message.media&&delete r.message.media),0<t.length&&void 0!==t[parseInt(r.message.sender_id)]&&(r.message.is_user_blocked_by=!0,r.message.sender_name=t[parseInt(r.message.sender_id)].blocked_user_name,r.message.sender_avatar=t[parseInt(r.message.sender_id)].blocked_avatar_url)),void 0!==window.Backbone.trigger&&void 0!==r.thread_id&&parseInt(r.thread_id)===parseInt(bb_pusher_vars.current_thread_id)&&window.Backbone.trigger("onReplySentSuccess",r),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements",r)},renderUpdateSendingMessage:function(e){var r=[];e.is_deleted=0,e.is_new=!0,e.is_starred=!1,e.star_link="",e.date=new Date,void 0!==e.gif&&Object.keys(e.gif).length<1&&delete e.gif,void 0!==e.video&&e.video.length<1&&delete e.video,void 0!==e.document&&e.document.length<1&&delete e.document,void 0!==e.media&&e.media.length<1&&delete e.media,r.push(e),void 0!==window.Backbone.trigger&&void 0!==e.thread_id&&parseInt(e.thread_id)===parseInt(bb_pusher_vars.current_thread_id)&&window.Backbone.trigger("onReplyReSend",r)},renderAjaxUpdateFailedMessage:function(e){void 0!==window.Backbone.trigger&&void 0!==e.thread_id&&parseInt(e.thread_id)===parseInt(bb_pusher_vars.current_thread_id)&&window.Backbone.trigger("onSentMessageError",e)},updateInboxMessageUnreadCount:function(r){r&&r.forEach(function(r){r.user_id===bb_pusher_vars.alien_hash&&(r.user_id=parseInt(bb_pusher_vars.loggedin_user_id));var n=parseInt(r.inbox_unread_count);parseInt(bb_pusher_vars.current_thread_id)===parseInt(r.thread_id)&&parseInt(bb_pusher_vars.loggedin_user_id)===parseInt(r.user_id)&&(n-=parseInt(r.current_thread_unread_count),e.ajax({type:"POST",url:bb_pusher_vars.ajax_url,data:{action:"bb_pusher_update_current_thread_unread_count",thread_id:r.thread_id,current_user_id:bb_pusher_vars.loggedin_user_id},success:function(){},error:function(){return!1}})),parseInt(bb_pusher_vars.current_thread_id)!==parseInt(r.thread_id)&&(e(document.body).find(".bb-message-dropdown-notification").length&&e(document.body).find(".bb-message-dropdown-notification .bb-member-unread-count-span-"+r.user_id).length&&(e(document.body).find(".bb-message-dropdown-notification .bb-member-unread-count-span-"+r.user_id+" span.count").length&&0<n?e(document.body).find(".bb-message-dropdown-notification .bb-member-unread-count-span-"+r.user_id+" span.count").text(n):e(document.body).find(".bb-message-dropdown-notification .bb-member-unread-count-span-"+r.user_id+" span.count").length&&0===n?e(document.body).find(".bb-message-dropdown-notification .bb-member-unread-count-span-"+r.user_id+" span.count").remove():0===e(document.body).find(".bb-message-dropdown-notification .bb-member-unread-count-span-"+r.user_id+" span.count").length&&0<n&&e(document.body).find(".bb-message-dropdown-notification .bb-member-unread-count-span-"+r.user_id).append('<span class="count">'+n+"</span>")),e(document.body).find(".bp-buddypanel-menu-item-messages-count-"+r.user_id).length&&0<n&&e(document.body).find(".bp-buddypanel-menu-item-messages-count-"+r.user_id).each(function(){e(this).find(".bb-messages-inbox-unread-count").length?e(this).find(".bb-messages-inbox-unread-count").text(n).removeClass("bp-hide"):e(this).find("> a").append('<span class="count bb-messages-inbox-unread-count">'+n+"</span>")}))})},UpdateThreadListing:function(r,n){var t;r&&(t=!1,r.forEach(function(r){e(document.body).find(".bp-messages-container").length&&e(document.body).find(".bp-messages-container .bp-messages-threads-list").length&&e(document.body).find(".bp-messages-container .bp-messages-threads-list-user-"+r.user_id).length&&void 0!==window.Backbone.trigger&&!1===t&&(window.Backbone.trigger("relistelements",n),t=!0)}))},bb_update_header_messages:function(){e(document.body).find("#header-messages-dropdown-elem").length&&!bp.Pusher_FrontCommon.xhr&&(e(document.body).find("#header-messages-dropdown-elem ul.notification-list").html('<p class="bb-header-loader"><i class="bb-icon-loader animate-spin"></i></p>'),bp.Pusher_FrontCommon.xhr=e.get(ajaxurl,{action:"buddyboss_theme_get_header_unread_messages"},function(r){r.success&&void 0!==r.data&&void 0!==r.data.contents&&e("#header-messages-dropdown-elem ul.notification-list").length&&(e(document.body).find("#header-messages-dropdown-elem ul.notification-list").html(r.data.contents),bp.Pusher_FrontCommon.xhr=!1)}))},presenceThreadMembers:function(){return bp.Pusher_FrontCommon.pusherPresenceThread},json2array:function(e){var r=[];return Object.keys(e).forEach(function(n){r.push(e[n])}),r},arrayIntersect:function(r,n){e(r).filter(n)},createCookie:function(e,r,n){var t,a="";n&&((t=new Date).setTime(t.getTime()+60*n*1e3),a="; expires="+t.toGMTString()),document.cookie=e+"="+r+a+"; path=/"},readCookie:function(e){for(var r=e+"=",n=document.cookie.split(";"),t=n.length,a=0;a<t;a++){for(var s=n[a];" "===s.charAt(0);)s=s.substring(1,s.length);if(0===s.indexOf(r))return s.substring(r.length,s.length)}return null},bbParseParams:function(t){function a(r,n,t){var s,i,o;-1!==(n+="").indexOf(".")?(i=n.split("."),s=n.split(/\.(.+)?/)[1],r[i[0]]||(r[i[0]]={}),""!==s&&a(r[i[0]],s,t)):-1!==n.indexOf("[")?(n=(i=n.split("["))[0],""==(o=(i=i[1].split("]"))[0])?((r=r||{})[n]&&e.isArray(r[n])||(r[n]=[]),r[n].push(t)):((r=r||{})[n]&&e.isArray(r[n])||(r[n]=[]),r[n][parseInt(o)]=t)):(r=r||{})[n]=t}""==(t+="")&&(t=window.location+"");var s,i={};if(t){if(-1!==t.indexOf("#")&&(t=t.substr(0,t.indexOf("#"))),-1===t.indexOf("?"))return{};if(""==(t=t.substr(t.indexOf("?")+1,t.length)))return;for(;s=r.exec(t);)a(i,n(s[1]),n(s[2]))}return i},SHA1:function(e){function r(e,r){return e<<r|e>>>32-r}function n(e){for(var r="",n=7;0<=n;n--)r+=(e>>>4*n&15).toString(16);return r}for(var t,a,s,i,o,d,u,h,g=Array(80),c=1732584193,m=4023233417,l=2562383102,p=271733878,b=3285377520,v=(e=function(e){e=e.replace(/\r\n/g,"\n");for(var r="",n=0;n<e.length;n++){var t=e.charCodeAt(n);t<128?r+=String.fromCharCode(t):(127<t&&t<2048?r+=String.fromCharCode(t>>6|192):(r+=String.fromCharCode(t>>12|224),r+=String.fromCharCode(t>>6&63|128)),r+=String.fromCharCode(63&t|128))}return r}(e)).length,f=[],$=0;$<v-3;$+=4)a=e.charCodeAt($)<<24|e.charCodeAt($+1)<<16|e.charCodeAt($+2)<<8|e.charCodeAt($+3),f.push(a);switch(v%4){case 0:$=2147483648;break;case 1:$=e.charCodeAt(v-1)<<24|8388608;break;case 2:$=e.charCodeAt(v-2)<<24|e.charCodeAt(v-1)<<16|32768;break;case 3:$=e.charCodeAt(v-3)<<24|e.charCodeAt(v-2)<<16|e.charCodeAt(v-1)<<8|128}for(f.push($);f.length%16!=14;)f.push(0);for(f.push(v>>>29),f.push(v<<3&4294967295),t=0;t<f.length;t+=16){for($=0;$<16;$++)g[$]=f[t+$];for($=16;$<=79;$++)g[$]=r(g[$-3]^g[$-8]^g[$-14]^g[$-16],1);for(s=c,i=m,o=l,d=p,u=b,$=0;$<=19;$++)h=r(s,5)+(i&o|~i&d)+u+g[$]+1518500249&4294967295,u=d,d=o,o=r(i,30),i=s,s=h;for($=20;$<=39;$++)h=r(s,5)+(i^o^d)+u+g[$]+1859775393&4294967295,u=d,d=o,o=r(i,30),i=s,s=h;for($=40;$<=59;$++)h=r(s,5)+(i&o|i&d|o&d)+u+g[$]+2400959708&4294967295,u=d,d=o,o=r(i,30),i=s,s=h;for($=60;$<=79;$++)h=r(s,5)+(i^o^d)+u+g[$]+3395469782&4294967295,u=d,d=o,o=r(i,30),i=s,s=h;c=c+s&4294967295,m=m+i&4294967295,l=l+o&4294967295,p=p+d&4294967295,b=b+u&4294967295}return(h=n(c)+n(m)+n(l)+n(p)+n(b)).toLowerCase()},triggerPusherChunked:function(e,r,n){var t=JSON.stringify(n),a=new Blob([t]).size,s=parseInt(bb_pusher_vars.content_size_limit),i=Math.ceil(a/s),o=Math.random();if(1<i)for(var d=1;d<=i;d++)e.trigger(r,{message_chunk_id:o,message_chunk_index:d-1,message_total_chunk:i,message_chunk:t.substr((d-1)*s,s),message_chunk_final:a<=s*d});else e.trigger(r,n)},bindWithPusherChunking:function(e,r,n){e.bind(r,n),e.bind("chunked-"+r,function(e){bp.Pusher_FrontCommon.chunks_event.hasOwnProperty(e.message_chunk_id)||(bp.Pusher_FrontCommon.chunks_event[e.message_chunk_id]={chunks:[]});var r=bp.Pusher_FrontCommon.chunks_event[e.message_chunk_id];r.chunks[e.message_chunk_index]=e.message_chunk,e.message_chunk_final&&r.chunks.length===e.message_total_chunk&&(n(JSON.parse(r.chunks.join(""))),delete bp.Pusher_FrontCommon.chunks_event[e.message_chunk_id])})},getWPCurrentTime:function(){var e=new Date,r=bb_pusher_vars.wp_offset,n=60*(e.getTimezoneOffset()+60*r)*1e3;e.setTime(e.getTime()+n);var t=e.getHours(),a=e.getMinutes(),s=12<=t?bb_pusher_vars.i18n.post_meridiem:bb_pusher_vars.i18n.ante_meridiem;return a<10&&(a="0"+a),(t=(t%=12)||12)+":"+a+" "+s}};var r=/([^&=]+)=?([^&]*)/g,n=function(e){return decodeURIComponent(e.replace(/\+/g," "))};bp.Pusher_FrontCommon.start()}((bp,jQuery));