window.bp=window.bp||{},window.Backbone=window.Backbone||[],function(I){bp.Pusher_FrontCommon={pusher:{},typer_data:{},xhr:!1,can_type:!0,throttleTime:6e3,clearInterval:6e3,clearTimerId:[],pendingRemoves:[],leaveWaitingTime:5e3,pusherPresenceThread:[],chunks_event:[],bb_pusher_channels:[],start:function(){"undefined"!=typeof bb_pusher_vars&&void 0!==bb_pusher_vars.loggedin_user_id&&0!==parseInt(bb_pusher_vars.loggedin_user_id)&&(this.setupGlobals(),this.addListeners(),I(document).on("ready",function(){bp.Pusher_FrontCommon.setupToast()}))},setupGlobals:function(){bp.Pusher_FrontCommon.typer_data=[],bb_pusher_vars.current_thread_recipients_count=0,bb_pusher_vars.current_thread_group_id=0,bp.Pusher_FrontCommon.pusher=this.pusherGlobalObject(),bp.Pusher_FrontCommon.pusher&&void 0!==bp.Pusher_FrontCommon.pusher.channels&&"on"===bb_pusher_vars.is_live_messaging_enabled&&(bp.Pusher_FrontCommon.bb_pusher_channels.push("private-bb-pro-global"),bp.Pusher_FrontCommon.bb_pusher_channels.push("private-bb-user-"+bb_pusher_vars.loggedin_user_id),0<Object.keys(bb_pusher_vars.group_threads).length&&I.each(bb_pusher_vars.group_threads,function(e,r){bp.Pusher_FrontCommon.bb_pusher_channels.push("private-bb-message-thread-"+r)}),bp.Pusher_FrontCommon.pusherLiveMessage()),bp.Pusher_FrontCommon.bb_pusher_channels.forEach(function(e){var r;"private-bb-pro-global"===e?bp.Pusher_FrontCommon.pusherGlobalChannel(e):-1<e.search("private-bb-message-thread-")?(r=e.replace("private-bb-message-thread-",""),bp.Pusher_FrontCommon.pusherSubscribeThreadsChannels(parseInt(r))):-1<e.search("private-bb-user-")&&bp.Pusher_FrontCommon.pusherSubscribeUserChannel(e)})},addListeners:function(){I(document).ajaxSuccess(function(e,r,s){var a,n,t,o,i="";bp.Pusher_FrontCommon.pusher&&void 0!==bp.Pusher_FrontCommon.pusher.channels&&"on"===bb_pusher_vars.is_live_messaging_enabled&&(s.hasOwnProperty("data")&&"string"==typeof s.data&&-1<s.data.search("action=messages_get_user_message_threads")&&void 0!==r.responseText&&(!0!==(i=I.parseJSON(r.responseText)).success||!i.data||0<(a=i.data.threads).length&&a.forEach(function(e){bp.Pusher_FrontCommon.pusherSubscribeThreadsChannels(parseInt(e.id))})),s.hasOwnProperty("url")&&"string"==typeof s.url&&-1<s.url.search("action=buddyboss_theme_get_header_unread_messages")&&void 0!==r.responseText&&"on"===bb_pusher_vars.is_live_messaging_enabled&&(!0!==(i=I.parseJSON(r.responseText)).success||!i.data||""!=(n=i.data.contents)&&((t=document.createElement("div")).innerHTML=n,0<(o=I(t).find("li")).length&&I.each(o,function(e,r){var s=I(r).attr("data-thread-id");bp.Pusher_FrontCommon.pusherSubscribeThreadsChannels(parseInt(s))}),t.remove())))})},setupToast:function(){var e=bp.Pusher_FrontCommon,r=e.readCookie("bb-thread-delete");r&&(jQuery(document).trigger("bb_trigger_toast_message",["",r,"warning",null,!0]),e.createCookie("bb-thread-delete","",-1));var s=e.readCookie("bb-message-component-disabled");s&&(jQuery(document).trigger("bb_trigger_toast_message",["",s,"warning",null,!0]),e.createCookie("bb-message-component-disabled","",-1));var a=e.readCookie("bb-message-group-thread-deleted");a&&(jQuery(document).trigger("bb_trigger_toast_message",["",a,"info",null,!0]),e.createCookie("bb-message-group-thread-deleted","",-1))},pusherGlobalObject:function(){var e={params:{bb_pusher_user_id:bb_pusher_vars.loggedin_user_id,bb_pusher_user_data:bb_pusher_vars.user_data,alien_hash:bb_pusher_vars.alien_hash}};return new Pusher(bb_pusher_vars.app_key,{authorizer:PusherBatchAuthorizer,cluster:bb_pusher_vars.app_cluster,authEndpoint:bb_pusher_vars.auth_endpoint,auth:e})},pusherGlobalChannel:function(e){bb_pusher_vars.global_channel=bp.Pusher_FrontCommon.pusher.subscribe(e),bb_pusher_vars.global_channel.bind("pusher:subscription_succeeded",function(){}),bb_pusher_vars.global_channel.bind("pusher:subscription_error",function(){}),bp.Pusher_FrontCommon.pusherModeration(bb_pusher_vars.global_channel),bp.Pusher_FrontCommon.pusherComponents(bb_pusher_vars.global_channel),bp.Pusher_FrontCommon.pusherSettingsUpdate(bb_pusher_vars.global_channel),bb_pusher_vars.global_channel.bind("client-bb-pro-message-access-control-update",function(){var e;bb_pusher_vars.current_thread_recipients_count<=1&&"no"===bb_pusher_vars.is_admin&&(e=(new Date).getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+bb_pusher_vars.current_thread_id+"/?hash="+e,{trigger:!0})),void 0!==window.Backbone.trigger&&"no"===bb_pusher_vars.is_admin&&window.Backbone.trigger("relistelements")}),bb_pusher_vars.global_channel.bind("client-bb-pro-message-is-connected",function(){var e;0<parseInt(bb_pusher_vars.current_thread_id)&&"no"===bb_pusher_vars.is_admin&&(e=(new Date).getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+bb_pusher_vars.current_thread_id+"/?hash="+e,{trigger:!0})),void 0!==window.Backbone.trigger&&"no"===bb_pusher_vars.is_admin&&window.Backbone.trigger("relistelements")}),bb_pusher_vars.global_channel.bind("client-bb-pro-update-group-messages",function(e){var r,s,a;parseInt(e.previous)!==parseInt(e.updated)&&(bb_pusher_vars.current_thread.is_group_thread&&!0===bb_pusher_vars.current_thread.is_group_thread&&(r=(new Date).getTime(),a=(s=I(".message-lists .thread-item:first-child")).find(".bp-message-link").attr("data-thread-id"),parseInt(a)===parseInt(bb_pusher_vars.current_thread_id)&&(a=s.next(".thread-item").find(".bp-message-link").attr("data-thread-id")),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+a+"/?hash="+r,{trigger:!0})),0===parseInt(e.updated)&&jQuery(document).trigger("bb_trigger_toast_message",["",bb_pusher_vars.i18n.group_message_disabled,"warning",null,!0]),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"),void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow())})},pusherSubscribeUserChannel:function(e){bb_pusher_vars.user_channel=bp.Pusher_FrontCommon.pusher.subscribe(e),bb_pusher_vars.user_channel.bind("pusher:subscription_succeeded",function(){}),bb_pusher_vars.user_channel.bind("pusher:subscription_error",function(){}),bb_pusher_vars.user_channel.bind("client-bb-pro-member-connection-requested",function(e){var r,s;bp.Nouveau.updateUserPresence(parseInt(e.friend_user_id),"online"),parseInt(bb_pusher_vars.loggedin_user_id)===parseInt(e.friend_user_id)&&(r=e.thread_ids,s=[],0<r.length&&I.each(r,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&s.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),0<s.length&&I.each(s,function(e,r){var s;parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(s=(new Date).getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+s,{trigger:!0}))}))}),bb_pusher_vars.user_channel.bind("client-bb-pro-member-withdrawn-connection-request",function(e){var r,s;bp.Nouveau.updateUserPresence(parseInt(e.friend_user_id),"online"),parseInt(bb_pusher_vars.loggedin_user_id)===parseInt(e.friend_user_id)&&(r=e.thread_ids,s=[],0<r.length&&I.each(r,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&s.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),0<s.length&&I.each(s,function(e,r){var s;parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(s=(new Date).getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+s,{trigger:!0}))}))}),bb_pusher_vars.user_channel.bind("client-bb-pro-member-accepted-connection-request",function(e){var r=e.thread_ids,s=[];bp.Nouveau.updateUserPresence(parseInt(e.initiator_user_id),"online"),0<r.length&&I.each(r,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&s.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),0<s.length&&I.each(s,function(e,r){var s;parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(s=(new Date).getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+s,{trigger:!0}))}),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements")}),bb_pusher_vars.user_channel.bind("client-bb-pro-member-rejected-connection-request",function(e){var r=e.thread_ids,s=[],a=(new Date).getTime();bp.Nouveau.updateUserPresence(parseInt(e.initiator_user_id),"online"),0<r.length&&I.each(r,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&s.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),0<s.length&&I.each(s,function(e,r){parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(a=(new Date).getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+a,{trigger:!0})),parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(a=(new Date).getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+a,{trigger:!0}))}),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements")}),bb_pusher_vars.user_channel.bind("client-bb-pro-member-blocked",function(s){var e,a,n,t;bp.Nouveau.updateUserPresence(parseInt(s.creator_id),"online"),"on"===bb_pusher_vars.is_live_messaging_enabled&&(s.creator_id&&parseInt(s.creator_id)===parseInt(bb_pusher_vars.loggedin_user_id)||s.blocked_id&&parseInt(s.blocked_id)===parseInt(bb_pusher_vars.loggedin_user_id))&&(e=s.thread_ids,a=[],0<e.length&&I.each(e,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&a.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),0<a.length&&(I.each(a,function(e,r){var s;parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(s=(new Date).getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+s,{trigger:!0}))}),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"))),"on"===bb_pusher_vars.is_live_messaging_enabled&&(s.creator_id&&parseInt(s.creator_id)===parseInt(bb_pusher_vars.loggedin_user_id)||s.blocked_id&&parseInt(s.blocked_id)===parseInt(bb_pusher_vars.loggedin_user_id))&&(s.blocked_id&&parseInt(s.blocked_id)===parseInt(bb_pusher_vars.loggedin_user_id)&&(n="",I.each(bb_pusher_vars.blocked_users_ids,function(e,r){parseInt(s.blocked_id)===parseInt(r.id)&&(n=e)}),""!==n&&delete bb_pusher_vars.blocked_users_ids[n]),s.creator_id&&parseInt(s.creator_id)===parseInt(bb_pusher_vars.loggedin_user_id)&&(t="",I.each(bb_pusher_vars.is_blocked_by_users,function(e,r){parseInt(s.creator_id)===parseInt(r.id)&&(t=e)}),""!==t&&delete bb_pusher_vars.is_blocked_by_users[t]),void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow())}),bb_pusher_vars.user_channel.bind("client-bb-pro-member-unblocked",function(s){var e,a,n,t;bp.Nouveau.updateUserPresence(parseInt(s.creator_id),"online"),"on"===bb_pusher_vars.is_live_messaging_enabled&&(s.creator_id&&parseInt(s.creator_id)===parseInt(bb_pusher_vars.loggedin_user_id)||s.unblocked_id&&parseInt(s.unblocked_id)===parseInt(bb_pusher_vars.loggedin_user_id))&&(e=s.thread_ids,a=[],0<e.length&&I.each(e,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&a.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),0<a.length&&(I.each(a,function(e,r){var s;parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(s=(new Date).getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+s,{trigger:!0}))}),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"))),"on"===bb_pusher_vars.is_live_messaging_enabled&&(n="",I.each(bb_pusher_vars.blocked_users_ids,function(e,r){parseInt(s.unblocked_id)===parseInt(r.id)&&(n=e)}),t="",I.each(bb_pusher_vars.is_blocked_by_users,function(e,r){parseInt(s.creator_id)===parseInt(r.id)&&(t=e)}),s.creator_id&&parseInt(s.creator_id)===parseInt(bb_pusher_vars.loggedin_user_id)&&s.unblocked_id&&""!==n&&delete bb_pusher_vars.blocked_users_ids[n],s.unblocked_id&&parseInt(s.unblocked_id)===parseInt(bb_pusher_vars.loggedin_user_id)&&s.creator_id&&""!==t&&delete bb_pusher_vars.is_blocked_by_users[t])}),bb_pusher_vars.user_channel.bind("client-bb-pro-group-message-group-update-notify",function(e){var r,s,a,n,t,o,i,_,d=e.action;""!==d&&(r=e.thread_id,s=0,a=e.sender_id,_="",bp.Nouveau.updateUserPresence(parseInt(a),"online"),void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&(s=parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r])),"group_message_group_joined"===d||"group_message_group_un_ban"===d?(void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow(),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"),0<s&&parseInt(s)===parseInt(bb_pusher_vars.current_thread_id)&&(_=(new Date).getTime(),bp.Nouveau.Messages.router.navigate("view/"+s+"/?hash="+_,{trigger:!0}))):"group_message_group_promoted"===d||"group_message_group_demoted"===d?0<s&&parseInt(s)===parseInt(bb_pusher_vars.current_thread_id)&&(_=(new Date).getTime(),bp.Nouveau.Messages.router.navigate("view/"+s+"/?hash="+_,{trigger:!0})):"group_message_group_left"!==d&&"group_message_group_ban"!==d&&"groups_remove_member"!==d||(parseInt(a)===parseInt(bb_pusher_vars.loggedin_user_id)&&0<s&&(bp.Nouveau.Messages.threads.remove(bp.Nouveau.Messages.threads.get(s)),0<s&&bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&delete bb_pusher_vars.bb_pro_pusher_thread_ids[r]),0<s&&s===parseInt(bb_pusher_vars.current_thread_id)&&(_=(new Date).getTime(),parseInt(a)===parseInt(bb_pusher_vars.loggedin_user_id)?(t=(n=I(".message-lists .thread-item:first-child")).find(".bp-message-link").attr("data-thread-id"),parseInt(t)===s&&(t=n.next(".thread-item").find(".bp-message-link").attr("data-thread-id")),o=I(".single-message-thread-header .participants-name").text(),i="","group_message_group_left"===d?i=bb_pusher_vars.i18n.thread_left+o:"group_message_group_ban"===d?i=bb_pusher_vars.i18n.group_banned+o:"groups_remove_member"===d&&(i=bb_pusher_vars.i18n.remove_from_group+o),jQuery(document).trigger("bb_trigger_toast_message",["",i,"info",null,!0]),void 0!==t?(bb_pusher_vars.current_thread_id=parseInt(t),bp.Nouveau.Messages.router.navigate("view/"+t+"/?hash="+_,{trigger:!0})):(bb_pusher_vars.current_thread_id=0,bp.Nouveau.Messages.router.navigate("compose/",{trigger:!0}))):bp.Nouveau.Messages.router.navigate("view/"+s+"/?hash="+_,{trigger:!0})),parseInt(a)===parseInt(bb_pusher_vars.loggedin_user_id)&&(void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"),void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow())))}),bb_pusher_vars.user_channel.bind("client-bb-pro-new-group-message",function(s){var a=bp.Pusher_FrontCommon.json2array(s.recipients);setTimeout(function(){var e,r;void 0!==a&&-1!==I.inArray(bb_pusher_vars.alien_hash,a)&&(void(e=0)!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[s.thread_id]&&(e=parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[s.thread_id])),0<parseInt(e)?(r=(new Date).getTime(),parseInt(e)===parseInt(bb_pusher_vars.current_thread_id)&&bp.Nouveau.Messages.router.navigate("view/"+e+"/?hash="+r,{trigger:!0}),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"),void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow()):void 0!==s.thread&&(bb_pusher_vars.group_threads[s.thread_id]=parseInt(s.thread),bp.Pusher_FrontCommon.pusherSubscribeThreadsChannels(parseInt(s.thread)),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements")))},500)}),bb_pusher_vars.user_channel.bind("client-bb-pro-new-thread-create",function(e){var r=e.thread_id,s=bp.Pusher_FrontCommon.json2array(e.recipients);setTimeout(function(){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0===bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&void 0!==s&&-1!==I.inArray(bb_pusher_vars.alien_hash,s)&&(void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"),void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow())},500)})},pusherSubscribeThreadsChannels:function(e){var r="live_message_"+e,s="private-bb-message-thread-"+e;void 0===bb_pusher_vars[r]&&(bb_pusher_vars[r]=bp.Pusher_FrontCommon.pusher.subscribe(s),bp.Pusher_FrontCommon.pusherMessageListen(bb_pusher_vars[r]))},pusherLiveMessage:function(){void 0!==bb_pusher_vars.current_thread_id&&0<bb_pusher_vars.current_thread_id&&bp.Pusher_FrontCommon.pusherSubscribeThreadsChannels(bb_pusher_vars.current_thread_id),I(document).on("heartbeat-tick",function(e,r){void 0!==r.bb_pro_pusher_thread_ids&&(bb_pusher_vars.bb_pro_pusher_thread_ids=r.bb_pro_pusher_thread_ids),void 0!==r.blocked_users_ids&&(bb_pusher_vars.blocked_users_ids=r.blocked_users_ids),void 0!==r.suspended_users_ids&&(bb_pusher_vars.suspended_users_ids=r.suspended_users_ids),void 0!==r.is_blocked_by_users&&(bb_pusher_vars.is_blocked_by_users=r.is_blocked_by_users),void 0!==r.group_threads&&(bb_pusher_vars.group_threads=r.group_threads),void 0!==bb_pusher_vars.group_threads&&0<Object.keys(bb_pusher_vars.group_threads).length&&I.each(bb_pusher_vars.group_threads,function(e,r){bp.Pusher_FrontCommon.pusherSubscribeThreadsChannels(parseInt(r))})}),I(document).on("click","#message-threads .thread-item",bp.Pusher_FrontCommon.pusherUpdateChannel.bind(this)),I(document).on("click",".bp-messages-nav-panel #compose",bp.Pusher_FrontCommon.pusherCompose.bind(this)),I(document).on("keyup","#message_content",bp.Pusher_FrontCommon.pusherMessageTypingEvent.bind(this)),I(document).ajaxComplete(function(e,r,s){var a,n,t,o,i;s.hasOwnProperty("data")&&"string"==typeof s.data&&0<s.data.search("action=messages_send_reply")&&void 0!==r.responseText&&(void 0!==(a=I.parseJSON(r.responseText)).data.type&&"error"===a.data.type&&(t={hash:(n=bp.Pusher_FrontCommon.bbParseParams(bb_pusher_vars.ajax_url+"?"+s.data)).hash,thread_id:n.thread_id,sender_id:parseInt(bb_pusher_vars.loggedin_user_id)},o="live_message_"+bb_pusher_vars.current_thread_id,bb_pusher_vars.current_thread_id&&parseInt(bb_pusher_vars.current_thread_id)===parseInt(n.thread_id)&&bb_pusher_vars[o]&&bb_pusher_vars[o].trigger("client-bb-pro-after-ajax-fail",t),i={hash:n.hash,actions:s.data,canceltext:bb_pusher_vars.cancel_text,notdeliveredtext:bb_pusher_vars.not_delivered_text,tryagaintext:bb_pusher_vars.try_again_text,thread_id:n.thread_id},bp.Pusher_FrontCommon.renderAjaxUpdateFailedMessage(i)))}),I(document).ajaxSuccess(function(e,r,s){var a,n,t,o,i,_,d,u,b,p,h,c,g="";s.hasOwnProperty("data")&&"string"==typeof s.data&&-1<s.data.search("action=messages_get_thread_messages")&&void 0!==r.responseText&&(!0===(a=I.parseJSON(r.responseText)).success&&a.data&&(n=parseInt(a.data.thread.id),bb_pusher_vars.current_thread=a.data,parseInt(bb_pusher_vars.current_thread_id)===n&&(n in bp.Pusher_FrontCommon.typer_data||(bp.Pusher_FrontCommon.typer_data[n]=[]),t=bp.Pusher_FrontCommon.typer_data[n].filter(function(e){return null!=e}),bp.Pusher_FrontCommon.singleThreadTypingIndicator(t),bp.Pusher_FrontCommon.threadListTypingIndicator(n,t),clearTimeout(bp.Pusher_FrontCommon.clearTimerId[n]),bp.Pusher_FrontCommon.clearTimerId[n]=setTimeout(function(){parseInt(n)===parseInt(bb_pusher_vars.current_thread_id)&&bp.Pusher_FrontCommon.singleThreadTypingIndicator([]),bp.Pusher_FrontCommon.threadListTypingIndicator(n,[])},bp.Pusher_FrontCommon.clearInterval)),bb_pusher_vars.current_thread_recipients_count=a.data.thread.recipients.current_count,bb_pusher_vars.current_thread_group_id=""!==a.data.group_id?parseInt(a.data.group_id):0,0===parseInt(bb_pusher_vars.current_thread_id)&&n&&(bb_pusher_vars.current_thread_id=n))),s.hasOwnProperty("data")&&"string"==typeof s.data&&-1<s.data.search("action=messages_get_user_message_threads")&&void 0!==r.responseText&&(!(o=I.parseJSON(r.responseText)).data.threads||0<(i=o.data.threads).length&&i.forEach(function(e){var r=parseInt(e.id);r in bp.Pusher_FrontCommon.typer_data||(bp.Pusher_FrontCommon.typer_data[r]=[]);var s=bp.Pusher_FrontCommon.typer_data[r].filter(function(e){return null!=e});bp.Pusher_FrontCommon.singleThreadTypingIndicator(s),bp.Pusher_FrontCommon.threadListTypingIndicator(r,s),clearTimeout(bp.Pusher_FrontCommon.clearTimerId[r]),bp.Pusher_FrontCommon.clearTimerId[r]=setTimeout(function(){parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&bp.Pusher_FrontCommon.singleThreadTypingIndicator([]),bp.Pusher_FrontCommon.threadListTypingIndicator(r,[])},bp.Pusher_FrontCommon.clearInterval)})),s.hasOwnProperty("data")&&"string"==typeof s.data&&-1<s.data.search("action=messages_send_reply")&&void 0!==r.responseText&&(void 0!==(_=I.parseJSON(r.responseText)).data.type&&"error"===_.data.type?(u={hash:(d=bp.Pusher_FrontCommon.bbParseParams(bb_pusher_vars.ajax_url+"?"+s.data)).hash,thread_id:d.thread_id,sender_id:parseInt(bb_pusher_vars.loggedin_user_id)},g="live_message_"+bb_pusher_vars.current_thread_id,bb_pusher_vars.current_thread_id&&parseInt(bb_pusher_vars.current_thread_id)===parseInt(d.thread_id)&&bb_pusher_vars[g]&&bb_pusher_vars[g].trigger("client-bb-pro-after-ajax-fail",u),b={hash:d.hash,actions:s.data,canceltext:bb_pusher_vars.cancel_text,notdeliveredtext:bb_pusher_vars.not_delivered_text,tryagaintext:bb_pusher_vars.try_again_text,thread_id:d.thread_id},bp.Pusher_FrontCommon.renderAjaxUpdateFailedMessage(b)):(p={hash:_.data.hash,message:_.data.messages[0],recipient_inbox_unread_counts:_.data.recipient_inbox_unread_counts,thread_id:_.data.thread_id},bp.Pusher_FrontCommon.renderAjaxUpdateMessage(p),bp.Pusher_FrontCommon.bb_update_header_messages())),s.hasOwnProperty("data")&&"string"==typeof s.data&&-1<s.data.search("action=messages_delete")&&void 0!==r.responseText&&(void 0!==(h=I.parseJSON(r.responseText)).data.recipient_inbox_unread_counts&&bp.Pusher_FrontCommon.updateInboxMessageUnreadCount(bp.Pusher_FrontCommon.json2array(h.data.recipient_inbox_unread_counts)),bp.Pusher_FrontCommon.bb_update_header_messages()),s.hasOwnProperty("data")&&"string"==typeof s.data&&-1<s.data.search("action=heartbeat")&&0<bb_pusher_vars.bb_pro_pusher_thread_ids.length&&bb_pusher_vars.bb_pro_pusher_thread_ids.forEach(function(e){var r;(e=parseInt(e))===parseInt(bb_pusher_vars.current_thread_id)&&(e in bp.Pusher_FrontCommon.typer_data||(bp.Pusher_FrontCommon.typer_data[e]=[]),r=bp.Pusher_FrontCommon.typer_data[e].filter(function(e){return null!=e}),bp.Pusher_FrontCommon.singleThreadTypingIndicator(r),bp.Pusher_FrontCommon.threadListTypingIndicator(e,r),clearTimeout(bp.Pusher_FrontCommon.clearTimerId[e]),bp.Pusher_FrontCommon.clearTimerId[e]=setTimeout(function(){parseInt(e)===parseInt(bb_pusher_vars.current_thread_id)&&bp.Pusher_FrontCommon.singleThreadTypingIndicator([]),bp.Pusher_FrontCommon.threadListTypingIndicator(e,[])},bp.Pusher_FrontCommon.clearInterval))}),s.hasOwnProperty("data")&&"string"==typeof s.data&&(-1<s.data.search("action=messages_unread")||-1<s.data.search("action=messages_read"))&&void 0!==r.responseText&&void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow(),s.hasOwnProperty("data")&&"string"==typeof s.data&&-1<s.data.search("action=messages_hide_thread")&&void 0!==r.responseText&&void 0!==bp.Nouveau.Messages.threads&&(void 0!==bp.Nouveau.Messages.threads.length&&0<bp.Nouveau.Messages.threads.length?bb_pusher_vars.current_thread_id=bp.Nouveau.Messages.threads.at(0).id:bb_pusher_vars.current_thread_id=0),s.hasOwnProperty("data")&&"string"==typeof s.data&&-1<s.data.search("action=groups_join_group")&&void 0!==r.responseText&&(void 0!==(c=I.parseJSON(r.responseText)).success&&!0===c.success&&bp.Pusher_FrontCommon.bb_update_header_messages())}),I(document).ajaxError(function(e,r,s){var a,n,t,o;s.hasOwnProperty("data")&&"string"==typeof s.data&&0<s.data.search("action=messages_send_reply")&&(n={hash:(a=bp.Pusher_FrontCommon.bbParseParams(bb_pusher_vars.ajax_url+"?"+s.data)).hash,thread_id:a.thread_id,sender_id:parseInt(bb_pusher_vars.loggedin_user_id)},t="live_message_"+bb_pusher_vars.current_thread_id,bb_pusher_vars.current_thread_id&&parseInt(bb_pusher_vars.current_thread_id)===parseInt(a.thread_id)&&bb_pusher_vars[t]&&bb_pusher_vars[t].trigger("client-bb-pro-after-ajax-fail",n),o={hash:a.hash,actions:s.data,canceltext:bb_pusher_vars.cancel_text,notdeliveredtext:bb_pusher_vars.not_delivered_text,tryagaintext:bb_pusher_vars.try_again_text,thread_id:a.thread_id},bp.Pusher_FrontCommon.renderAjaxUpdateFailedMessage(o))}),I(document).ajaxSend(function(e,r,s){var a,n,t,o,i,_,d,u,b,p,h,c,g,m,v,l,w,f;s.hasOwnProperty("data")&&"string"==typeof s.data&&0<s.data.search("action=messages_send_reply")&&(a=bp.Pusher_FrontCommon.bb_unserialize(s.data),n=[],t=[],o=[],i=[],_=[],d={},u=window.deparam(s.data),b='<div class="message_send_sending"><span class="info-text-send-message">'+bb_pusher_vars.sending_text+"</span></div>",delete a.nonce,delete a.action,I.each(a,function(e){(-1<e.search("media")||-1<e.search("video")||-1<e.search("document")||-1<e.search("gif_data"))&&delete a[e]}),void 0!==u.media&&u.media&&(u.media.forEach(function(e){var r=e.thumb;void 0!==e.js_preview&&(r=e.js_preview);var s=null,a=null;1===u.media.length&&(s=e.image_h,a=e.image_w),n.push({id:e.id,attachment_id:e.id,full:e.url,privacy:e.privacy,thumbnail:e.msg_url||e.medium||e.thumb,title:e.name,height:s,width:a,menu_order:parseInt(e.menu_order)}),t.push({id:e.id,attachment_id:e.id,full:e.url,privacy:e.privacy,thumbnail:r,title:e.name,height:s,width:a,menu_order:parseInt(e.menu_order)})}),1<n.length&&n.sort(function(e,r){return e.menu_order-r.menu_order}),1<t.length&&t.sort(function(e,r){return e.menu_order-r.menu_order})),void 0!==u.video&&u.video&&(u.video.forEach(function(e){void 0===e.js_preview&&(e.js_preview=bb_pusher_vars.video_default_url),i.push({id:e.id,attachment_id:e.id,full:e.url,privacy:e.privacy,thumbnail:bb_pusher_vars.video_default_url,title:e.name,vid_ids_fake:e.vid_msg_url,ext:e.ext,menu_order:parseInt(e.menu_order)}),_.push({id:e.id,attachment_id:e.id,full:e.url,privacy:e.privacy,thumbnail:e.js_preview,title:e.name,vid_ids_fake:e.vid_msg_url,ext:e.ext,menu_order:parseInt(e.menu_order)})}),1<i.length&&i.sort(function(e,r){return e.menu_order-r.menu_order}),1<_.length&&_.sort(function(e,r){return e.menu_order-r.menu_order})),void 0!==u.document&&u.document&&(u.document.forEach(function(e){o.push({id:e.id,attachment_id:e.id,full:e.url,privacy:e.privacy,thumbnail:"",title:e.name,url:e.url,svg_icon:e.svg_icon,extension:e.extension,author:"",preview:"",full_preview:"",text_preview:"",mp3_preview:"",document_title:e.name,mirror_text:"",size:e.size,extension_description:"",download_text:"",download:"",copy_download_link:"",msg_preview:"",menu_order:parseInt(e.menu_order)})}),1<o.length&&o.sort(function(e,r){return e.menu_order-r.menu_order})),void 0!==u.gif_data&&u.gif_data&&(p="",void 0!==u.gif_data.images["480w_still"].url&&(p=u.gif_data.images["480w_still"].url),d.video_url=u.gif_data.images.original_mp4.mp4,d.preview_url=p),h=new URLSearchParams(s.data),c=Object.fromEntries(h),g=(g=I.trim(I("<p>"+c.content+"<p>").text())).replace(/&nbsp;/g," "),l=m=void 0!==a.hash?a.hash:(new Date).getTime(),w=v=""===g?"":c.content,void 0!==u.resend&&(l=m+" sending",w+=b),(n||i||o)&&(l+=" has-medias"),a.id=m,a.sender_id=bb_pusher_vars.loggedin_user_id,a.sender_name=bb_pusher_vars.loggedin_user_name,a.gif=d,a.is_user_suspended="true"===a.is_user_suspended,a.is_user_blocked="true"===a.is_user_blocked,a.is_user_deleted="true"===a.is_user_deleted,a.sender_avatar=bb_pusher_vars.sender_avatar,a.sender_link=bb_pusher_vars.sender_link,a.display_date=bp.Pusher_FrontCommon.getWPCurrentTime(),a.className=l,a.sender_is_you=!0,a.thread_id=bb_pusher_vars.current_thread_id,a.content=w,a.excerpt="",w&&(a.excerpt=w.replace(/(<br\s*?\/?>|<\/(\w+)><(\w+)>)/g," ").replace(/(<([^>]+)>)/gi,"").replace(/\s+/g," "),75<a.excerpt.length&&(a.excerpt=a.excerpt.substring(0,75)+"...")),a.media=n,a.video=i,a.document=o,a.is_group=!1,void 0!==bb_pusher_vars.current_thread.group_id&&0<parseInt(bb_pusher_vars.current_thread.group_id)&&(a.is_group=!0),void 0!==u.resend?bp.Pusher_FrontCommon.renderUpdateSendingMessage(a):(a.media=t,a.video=_,bp.Pusher_FrontCommon.renderMessage(a)),a.media=n,a.video=i,a.has_media=!1,(0<n.length||0<i.length||0<o.length||void 0!==d.video_url&&void 0!==d.preview_url)&&(a.has_media=!0),f="live_message_"+bb_pusher_vars.current_thread_id,a.content=v,bb_pusher_vars[f]&&(a.sender_is_you=!1,bp.Pusher_FrontCommon.triggerPusherChunked(bb_pusher_vars[f],"client-bb-pro-before-message-ajax-send",a)),I("#messages-media-button").length&&I("#messages-media-button").removeClass("active"),I("#messages-video-button").length&&I("#messages-video-button").removeClass("active"),I("#messages-document-button").length&&I("#messages-document-button").removeClass("active"),I("#messages-gif-button").length&&I("#messages-gif-button").removeClass("active"),I(window).trigger("scroll"))})},pusherMessageListen:function(e){e.bind("pusher:subscription_succeeded",function(){}),e.bind("pusher:subscription_error",function(){}),e.bind("client-bb-pro-before-message-ajax-send",function(e){var r;void 0!==e.sender_id&&(bp.Nouveau.updateUserPresence(parseInt(e.sender_id),"online"),void 0!==e.thread_id&&bp.Pusher_FrontCommon.threadTypingEnd(parseInt(e.thread_id),parseInt(e.sender_id))),void 0!==e.message_chunk_id?(bp.Pusher_FrontCommon.chunks_event.hasOwnProperty(e.message_chunk_id)||(bp.Pusher_FrontCommon.chunks_event[e.message_chunk_id]={chunks:[]}),(r=bp.Pusher_FrontCommon.chunks_event[e.message_chunk_id]).chunks[e.message_chunk_index]=e.message_chunk,e.message_chunk_final&&r.chunks.length===e.message_total_chunk&&(bp.Pusher_FrontCommon.renderMessage(JSON.parse(r.chunks.join(""))),delete bp.Pusher_FrontCommon.chunks_event[e.message_chunk_id])):bp.Pusher_FrontCommon.renderMessage(e),void 0!==window.Backbone.trigger&&void 0!==e.refresh_element&&!0===e.refresh_element&&window.Backbone.trigger("relistelements")}),bp.Pusher_FrontCommon.bindWithPusherChunking(e,"client-bb-pro-after-message-ajax-complete",function(e){e.message,bp.Pusher_FrontCommon.renderAjaxUpdateMessage(e),bp.Pusher_FrontCommon.updateInboxMessageUnreadCount(e.recipient_inbox_unread_counts),bp.Pusher_FrontCommon.UpdateThreadListing(e.recipient_inbox_unread_counts,e),bp.Pusher_FrontCommon.bb_update_header_messages(),I(window).trigger("scroll")}),e.bind("client-bb-pro-thread-delete-message",function(e){void 0!==window.Backbone.trigger&&void 0!==e.thread_id&&(window.Backbone.trigger("onMessageDeleteSuccess",e),bp.Pusher_FrontCommon.bb_update_header_messages())}),e.bind("client-bb-pro-after-ajax-fail",function(e){void 0!==window.Backbone.trigger&&void 0!==e.thread_id&&parseInt(e.thread_id)===parseInt(bb_pusher_vars.current_thread_id)&&window.Backbone.trigger("onMessageAjaxFail",e)}),e.bind("client-bb-pro-typing-start",function(e){var r,s=parseInt(e.thread_id),a=parseInt(e.user_id);bp.Nouveau.updateUserPresence(a,"online"),a!==parseInt(bb_pusher_vars.loggedin_user_id)&&(s in bp.Pusher_FrontCommon.typer_data||(bp.Pusher_FrontCommon.typer_data[s]=[]),a in bp.Pusher_FrontCommon.typer_data[s]||(bp.Pusher_FrontCommon.typer_data[s][a]=e.username),r=bp.Pusher_FrontCommon.typer_data[s].filter(function(e){return null!=e}),parseInt(s)===parseInt(bb_pusher_vars.current_thread_id)&&bp.Pusher_FrontCommon.singleThreadTypingIndicator(r),bp.Pusher_FrontCommon.threadListTypingIndicator(s,r),clearTimeout(bp.Pusher_FrontCommon.clearTimerId[s]),bp.Pusher_FrontCommon.clearTimerId[s]=setTimeout(function(){bp.Pusher_FrontCommon.threadTypingEnd(s,a)},bp.Pusher_FrontCommon.clearInterval))}),e.bind("client-bb-pro-typing-end",function(e){bp.Pusher_FrontCommon.threadTypingEnd(e.thread_id,e.user_id)}),e.bind("client-bb-pro-group-message-group-update-notify",function(e){var r,s,a,n,t,o,i,_,d=e.action;""!==d&&(r=e.thread_id,s=0,a=e.sender_id,_="",bp.Nouveau.updateUserPresence(parseInt(a),"online"),void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&(s=parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r])),"group_message_group_joined"===d||"group_message_group_un_ban"===d?(void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow(),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"),0<s&&parseInt(s)===parseInt(bb_pusher_vars.current_thread_id)&&(_=(new Date).getTime(),bp.Nouveau.Messages.router.navigate("view/"+s+"/?hash="+_,{trigger:!0}))):"group_message_group_promoted"===d||"group_message_group_demoted"===d?0<s&&parseInt(s)===parseInt(bb_pusher_vars.current_thread_id)&&(_=(new Date).getTime(),bp.Nouveau.Messages.router.navigate("view/"+s+"/?hash="+_,{trigger:!0})):"group_message_group_left"!==d&&"group_message_group_ban"!==d&&"groups_remove_member"!==d||(parseInt(a)===parseInt(bb_pusher_vars.loggedin_user_id)&&0<s&&(bp.Nouveau.Messages.threads.remove(bp.Nouveau.Messages.threads.get(s)),0<s&&bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&delete bb_pusher_vars.bb_pro_pusher_thread_ids[r]),0<s&&s===parseInt(bb_pusher_vars.current_thread_id)&&(_=(new Date).getTime(),parseInt(a)===parseInt(bb_pusher_vars.loggedin_user_id)?(t=(n=I(".message-lists .thread-item:first-child")).find(".bp-message-link").attr("data-thread-id"),parseInt(t)===s&&(t=n.next(".thread-item").find(".bp-message-link").attr("data-thread-id")),o=I(".single-message-thread-header .participants-name").text(),i="","group_message_group_left"===d?i=bb_pusher_vars.i18n.thread_left+o:"group_message_group_ban"===d?i=bb_pusher_vars.i18n.group_banned+o:"groups_remove_member"===d&&(i=bb_pusher_vars.i18n.remove_from_group+o),jQuery(document).trigger("bb_trigger_toast_message",["",i,"info",null,!0]),void 0!==t?(bb_pusher_vars.current_thread_id=parseInt(t),bp.Nouveau.Messages.router.navigate("view/"+t+"/?hash="+_,{trigger:!0})):(bb_pusher_vars.current_thread_id=0,bp.Nouveau.Messages.router.navigate("compose/",{trigger:!0}))):bp.Nouveau.Messages.router.navigate("view/"+s+"/?hash="+_,{trigger:!0})),parseInt(a)===parseInt(bb_pusher_vars.loggedin_user_id)&&(void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"),void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow())))}),e.bind("client-bb-pro-group-thread-deleted",function(e){var r,s=e.thread_id,a=0;void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[s]&&(a=parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[s])),0<a&&a===parseInt(bb_pusher_vars.current_thread_id)?(r=e.group_name+bb_pusher_vars.i18n.deleted,1<bp.Nouveau.Messages.threads.length?(bp.Nouveau.Messages.threads.remove(parseInt(a)),bb_pusher_vars.current_thread_id=parseInt(bp.Nouveau.Messages.threads.at(0).id),bp.Nouveau.Messages.router.navigate("view/"+bb_pusher_vars.current_thread_id+"/",{trigger:!0})):(BP_Nouveau.messages.hasThreads=!1,bb_pusher_vars.current_thread_id=0,bp.Nouveau.Messages.router.navigate("compose/",{trigger:!0})),void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow(),jQuery(document).trigger("bb_trigger_toast_message",["",r,"info",null,!0])):(bp.Nouveau.Messages.threads.remove(parseInt(a)),void 0!==window.Backbone.trigger&&"no"===bb_pusher_vars.is_admin&&window.Backbone.trigger("relistelements"),void 0!==window.wp.heartbeat&&window.wp.heartbeat.connectNow())}),e.bind("client-bb-pro-group-setting-update",function(e){var r,s=e.thread_id,a=0;void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[s]&&(a=parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[s])),0!==a&&bb_pusher_vars.current_thread_id===a&&"no"===bb_pusher_vars.is_admin&&-1!==I.inArray(bb_pusher_vars.alien_hash,e.member_ids)&&(r=(new Date).getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+bb_pusher_vars.current_thread_id+"/?hash="+r,{trigger:!0}))}),e.bind("client-bb-pro-thread-delete",function(e){var r,s,a,n,t=e.thread_id,o=0,i=e.recipients;void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[t]&&(o=parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[t])),0!==parseInt(o)&&(parseInt(o)===parseInt(bb_pusher_vars.current_thread_id)?(s="",void 0!==e.group_name?(s=e.group_name+bb_pusher_vars.i18n.deleted,bp.Pusher_FrontCommon.createCookie("bb-message-group-thread-deleted",s,5)):(r=(r=bp.Pusher_FrontCommon.json2array(i).map(function(e){if(e.user_id!==bb_pusher_vars.alien_hash)return e.name})).filter(function(e){return null!=e}),s=wp.i18n.sprintf(bb_pusher_vars.i18n.conversion_delete,r.join(", ")),bp.Pusher_FrontCommon.createCookie("bb-thread-delete",s,5)),"undefined"!=typeof BP_Nouveau&&void 0!==BP_Nouveau.messages&&void 0!==BP_Nouveau.messages.message_url?window.location.href=BP_Nouveau.messages.message_url:window.location.reload()):(0<(a=I('#message-threads li .bp-message-link[data-thread-id="'+o+'"]')).length&&a.parents(".thread-item").remove(),0<(n=I('#header-messages-dropdown-elem li[data-thread-id="'+o+'"]')).length&&n.remove(),i[bb_pusher_vars.alien_hash]&&(i=bp.Pusher_FrontCommon.json2array(i),bp.Pusher_FrontCommon.updateInboxMessageUnreadCount(i),bp.Pusher_FrontCommon.bb_update_header_messages(),0<o&&bb_pusher_vars.bb_pro_pusher_thread_ids[t]&&delete bb_pusher_vars.bb_pro_pusher_thread_ids[t])))})},threadTypingEnd:function(e,r){var s=parseInt(e),a=parseInt(r);bp.Nouveau.updateUserPresence(a,"online"),s in bp.Pusher_FrontCommon.typer_data||(bp.Pusher_FrontCommon.typer_data[s]=[]),r in bp.Pusher_FrontCommon.typer_data[s]&&delete bp.Pusher_FrontCommon.typer_data[s][a];var n=bp.Pusher_FrontCommon.typer_data[s].filter(function(e){return null!=e});parseInt(s)===parseInt(bb_pusher_vars.current_thread_id)&&bp.Pusher_FrontCommon.singleThreadTypingIndicator(n),bp.Pusher_FrontCommon.threadListTypingIndicator(s,n)},singleThreadTypingIndicator:function(e){var r;0<e.length&&I(".bp-messages-content .bp-messages-notice").find(".bp-user-messages-feedback").length<1?(r=e.length+bb_pusher_vars.i18n.two_typing,1===e.length?r="<strong>"+e.join("</strong>, <strong>")+"</strong>"+bb_pusher_vars.i18n.single_typing:2===e.length?r="<strong>"+e.join("</strong>"+bb_pusher_vars.i18n.separator+"<strong>")+"</strong>"+bb_pusher_vars.i18n.typing:2<e.length&&(r="<strong>"+e[0]+"</strong>"+bb_pusher_vars.i18n.separator+(e.length-1)+bb_pusher_vars.i18n.multiple_typing),I(".bb-pusher-typing-indicator .bb-pusher-typing-indicator-text-inner").html(r),I(".bb-pusher-typing-indicator").removeClass("bp-hide")):I(".bb-pusher-typing-indicator").addClass("bp-hide")},threadListTypingIndicator:function(e,r){var s,a=I('#message-threads li .bp-message-link[data-thread-id="'+e+'"]');0<r.length&&(0===I(".bp-messages-notice").find(".bp-user-messages-feedback").length||"unarchived"!==bp.Nouveau.Messages.threadType)?(s=r.length+bb_pusher_vars.i18n.two_typing,1===r.length&&(s=r.join(", ")+bb_pusher_vars.i18n.single_typing),a.find(".typing-indicator").html(s).removeClass("bp-hide"),a.find(".thread-excerpt").addClass("bp-hide")):(a.find(".typing-indicator").html("").addClass("bp-hide"),a.find(".thread-excerpt").removeClass("bp-hide"));var n,t=I('#header-messages-dropdown-elem li[data-thread-id="'+e+'"]');0<t.length&&(0<r.length&&0===I(".bp-messages-notice").find(".bp-user-messages-feedback").length?(n=r.length+bb_pusher_vars.i18n.two_typing,1===r.length&&(n=r.join(", ")+bb_pusher_vars.i18n.single_typing),t.find(".typing-indicator").html(n).removeClass("bp-hide"),t.find(".posted").addClass("bp-hide")):(t.find(".typing-indicator").html("").addClass("bp-hide"),t.find(".posted").removeClass("bp-hide")))},pusherUpdateChannel:function(e){var r;I(e.currentTarget).hasClass("optionsOpen")||(r=I(e.currentTarget).find(".bp-message-link").data("thread-id"))&&(bb_pusher_vars.current_thread_id=parseInt(r),bb_pusher_vars.thread_channel="private-bb-message-thread-"+r,0!==parseInt(r)&&-1!==I.inArray(parseInt(r),bb_pusher_vars.bb_pro_pusher_thread_ids)&&bp.Pusher_FrontCommon.pusherSubscribeThreadsChannels(r))},pusherCompose:function(){bb_pusher_vars.current_thread_id=0,bb_pusher_vars.thread_channel=""},pusherMessageTypingEvent:function(e){var r,s,a,n=I(e.currentTarget).text();0!==parseInt(bb_pusher_vars.current_thread_id)&&13!==e.keyCode&&9!==e.keyCode&&16!==e.keyCode&&(r="live_message_"+bb_pusher_vars.current_thread_id,(s=document.createElement("div")).innerHTML=n,a=s.textContent||s.innerText||"",setTimeout(function(){""!==a&&bb_pusher_vars[r]?bp.Pusher_FrontCommon.can_type&&(bp.Pusher_FrontCommon.can_type=!1,bb_pusher_vars[r].trigger("client-bb-pro-typing-start",{username:bb_pusher_vars.loggedin_user_name,user_id:bb_pusher_vars.loggedin_user_id,thread_id:bb_pusher_vars.current_thread_id}),setTimeout(function(){bp.Pusher_FrontCommon.can_type=!0},bp.Pusher_FrontCommon.throttleTime)):""===a&&bb_pusher_vars[r]&&(bp.Pusher_FrontCommon.can_type=!0,bb_pusher_vars[r].trigger("client-bb-pro-typing-end",{username:bb_pusher_vars.loggedin_user_name,user_id:bb_pusher_vars.loggedin_user_id,thread_id:bb_pusher_vars.current_thread_id}))},300))},pusherModeration:function(e){e.bind("client-bb-pro-member-suspended",function(e){var r,s;e.user_id&&void(bb_pusher_vars.suspended_users_ids[e.user_id]=0)!==window.wp.heartbeat&&window.wp.heartbeat.connectNow(),e.user_id===bb_pusher_vars.alien_hash?window.location.reload():(r=e.thread_ids,s=[],0<r.length&&I.each(r,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&s.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),0<s.length&&(I.each(s,function(e,r){var s;parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(s=(new Date).getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+s,{trigger:!0}))}),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements")))}),e.bind("client-bb-pro-member-deleted",function(e){var r,s;e.user_id===bb_pusher_vars.alien_hash?window.location.reload():(r=e.thread_ids,s=[],0<r.length&&I.each(r,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&s.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),0<s.length&&(I.each(s,function(e,r){var s;parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(s=(new Date).getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+s,{trigger:!0}))}),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements")))}),e.bind("client-bb-pro-member-unsuspended",function(e){var r=e.thread_ids,s=[];0<r.length&&I.each(r,function(e,r){void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids&&void 0!==bb_pusher_vars.bb_pro_pusher_thread_ids[r]&&s.push(parseInt(bb_pusher_vars.bb_pro_pusher_thread_ids[r]))}),e.user_id&&void 0!==bb_pusher_vars.suspended_users_ids[e.user_id]&&delete bb_pusher_vars.suspended_users_ids[e.user_id],0<s.length&&(I.each(s,function(e,r){var s;parseInt(r)===parseInt(bb_pusher_vars.current_thread_id)&&(s=(new Date).getTime(),window.location.href.replace(window.location.search,""),bp.Nouveau.Messages.router.navigate("view/"+r+"/?hash="+s,{trigger:!0}))}),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements"))})},pusherComponents:function(e){e.bind("client-bb-pro-active-components",function(e){var r,s=e.previous,a=e.updated;s.messages&&void 0===a.messages&&(void 0!==bb_pusher_vars.current_thread_id?(r=bb_pusher_vars.i18n.disabled_private_message,bp.Pusher_FrontCommon.createCookie("bb-message-component-disabled",r,5),window.location.href=bb_pusher_vars.home_url):(I(document.body).find(".bb-message-dropdown-notification").length&&I(document.body).find(".bb-message-dropdown-notification").remove(),I(document.body).find(".bp-messages-nav").length&&I(document.body).find(".bp-messages-nav").remove(),I(document.body).find(".bp-compose-messages-nav").length&&I(document.body).find(".bp-compose-messages-nav").remove(),I(document.body).find(".bp-inbox-sub-nav").length&&I(document.body).find(".bp-inbox-sub-nav").remove(),I(document.body).find("#wp-admin-bar-my-account-messages").length&&I(document.body).find("#wp-admin-bar-my-account-messages").remove(),I(document.body).find(".header-aside-inner #wp-admin-bar-my-account-messages").length&&I(document.body).find(".header-aside-inner #wp-admin-bar-my-account-messages").remove()))})},pusherSettingsUpdate:function(e){e.bind("client-bb-pro-pusher-settings-change",function(){window.location.reload()})},bb_unserialize:function(e){for(var r,s,a,n=decodeURI(e).split("&"),t={},o=0,i=n.length;o<i;o++){(a=(s=n[o].split("="))[0]).indexOf("[]")===a.length-2?(void 0===t[r=a.substring(0,a.length-2)]&&(t[r]=[]),t[decodeURIComponent(r)].push(decodeURIComponent(s[1]))):t[decodeURIComponent(a)]=decodeURIComponent(s[1])}return t},renderMessage:function(e){var r=[];e.is_deleted=0,e.is_new=!0,e.is_starred=!1,e.star_link="",e.date=new Date,void 0!==e.gif&&Object.keys(e.gif).length<1&&delete e.gif,void 0!==e.video&&e.video.length<1&&delete e.video,void 0!==e.document&&e.document.length<1&&delete e.document,void 0!==e.media&&e.media.length<1&&delete e.media,bp.Pusher_FrontCommon.threadTypingEnd(parseInt(e.thread_id),parseInt(e.sender_id));var s=[];Object.values(bb_pusher_vars.blocked_users_ids).forEach(function(e){s[parseInt(e.id)]=e}),0<s.length&&void 0!==s[parseInt(e.sender_id)]&&(e.is_user_blocked=!0,e.sender_name=s[parseInt(e.sender_id)].blocked_user_name,e.sender_avatar=s[parseInt(e.sender_id)].blocked_avatar_url,e.content=bb_pusher_vars.blocked_message_text,e.sender_link="",void 0!==e.gif&&delete e.gif,void 0!==e.video&&delete e.video,void 0!==e.document&&delete e.document,void 0!==e.media&&delete e.media),-1<I.inArray(parseInt(e.sender_id),bb_pusher_vars.suspended_users_ids)&&(e.is_user_suspended=!0,e.sender_name=bb_pusher_vars.suspended_avatar,e.sender_avatar=bb_pusher_vars.suspended_avatar,e.content=bb_pusher_vars.suspended_message_text,e.sender_link="",void 0!==e.gif&&delete e.gif,void 0!==e.video&&delete e.video,void 0!==e.document&&delete e.document,void 0!==e.media&&delete e.media);var a=[];Object.values(bb_pusher_vars.is_blocked_by_users).forEach(function(e){a[parseInt(e.id)]=e}),0<a.length&&void 0!==a[parseInt(e.sender_id)]&&(e.is_user_blocked_by=!0,e.sender_name=a[parseInt(e.sender_id)].blocked_user_name,e.sender_avatar=a[parseInt(e.sender_id)].blocked_avatar_url),r.push(e),void 0!==window.Backbone.trigger&&void 0!==e.thread_id&&parseInt(e.thread_id)===parseInt(bb_pusher_vars.current_thread_id)&&window.Backbone.trigger("onSentMessage",r)},renderAjaxUpdateMessage:function(e){var r=[];Object.values(bb_pusher_vars.blocked_users_ids).forEach(function(e){r[parseInt(e.id)]=e});var s=[];Object.values(bb_pusher_vars.is_blocked_by_users).forEach(function(e){s[parseInt(e.id)]=e}),void 0!==e.thread_id&&void 0!==e.message&&(0<r.length&&void 0!==r[parseInt(e.message.sender_id)]&&(e.message.is_user_blocked=!0,e.message.sender_name=r[parseInt(e.message.sender_id)].blocked_user_name,e.message.sender_avatar=r[parseInt(e.message.sender_id)].blocked_avatar_url,e.message.content=bb_pusher_vars.blocked_message_text,e.message.sender_link="",void 0!==e.message.gif&&delete e.message.gif,void 0!==e.message.video&&delete e.message.video,void 0!==e.message.document&&delete e.message.document,void 0!==e.message.media&&delete e.message.media),-1<I.inArray(parseInt(e.message.sender_id),bb_pusher_vars.suspended_users_ids)&&(e.message.is_user_suspended=!0,e.message.sender_name=bb_pusher_vars.suspended_avatar,e.message.sender_avatar=bb_pusher_vars.suspended_avatar,e.message.content=bb_pusher_vars.suspended_message_text,e.message.sender_link="",void 0!==e.message.gif&&delete e.message.gif,void 0!==e.message.video&&delete e.message.video,void 0!==e.message.document&&delete e.message.document,void 0!==e.message.media&&delete e.message.media),0<s.length&&void 0!==s[parseInt(e.message.sender_id)]&&(e.message.is_user_blocked_by=!0,e.message.sender_name=s[parseInt(e.message.sender_id)].blocked_user_name,e.message.sender_avatar=s[parseInt(e.message.sender_id)].blocked_avatar_url)),void 0!==window.Backbone.trigger&&void 0!==e.thread_id&&parseInt(e.thread_id)===parseInt(bb_pusher_vars.current_thread_id)&&window.Backbone.trigger("onReplySentSuccess",e),void 0!==window.Backbone.trigger&&window.Backbone.trigger("relistelements",e)},renderUpdateSendingMessage:function(e){var r=[];e.is_deleted=0,e.is_new=!0,e.is_starred=!1,e.star_link="",e.date=new Date,void 0!==e.gif&&Object.keys(e.gif).length<1&&delete e.gif,void 0!==e.video&&e.video.length<1&&delete e.video,void 0!==e.document&&e.document.length<1&&delete e.document,void 0!==e.media&&e.media.length<1&&delete e.media,r.push(e),void 0!==window.Backbone.trigger&&void 0!==e.thread_id&&parseInt(e.thread_id)===parseInt(bb_pusher_vars.current_thread_id)&&window.Backbone.trigger("onReplyReSend",r)},renderAjaxUpdateFailedMessage:function(e){void 0!==window.Backbone.trigger&&void 0!==e.thread_id&&parseInt(e.thread_id)===parseInt(bb_pusher_vars.current_thread_id)&&window.Backbone.trigger("onSentMessageError",e)},updateInboxMessageUnreadCount:function(e){e&&e.forEach(function(e){e.user_id===bb_pusher_vars.alien_hash&&(e.user_id=parseInt(bb_pusher_vars.loggedin_user_id));var r=parseInt(e.inbox_unread_count);parseInt(bb_pusher_vars.current_thread_id)===parseInt(e.thread_id)&&parseInt(bb_pusher_vars.loggedin_user_id)===parseInt(e.user_id)&&(r-=parseInt(e.current_thread_unread_count),I.ajax({type:"POST",url:bb_pusher_vars.ajax_url,data:{action:"bb_pusher_update_current_thread_unread_count",thread_id:e.thread_id,current_user_id:bb_pusher_vars.loggedin_user_id},success:function(){},error:function(){return!1}})),parseInt(bb_pusher_vars.current_thread_id)!==parseInt(e.thread_id)&&(I(document.body).find(".bb-message-dropdown-notification").length&&I(document.body).find(".bb-message-dropdown-notification .bb-member-unread-count-span-"+e.user_id).length&&(I(document.body).find(".bb-message-dropdown-notification .bb-member-unread-count-span-"+e.user_id+" span.count").length&&0<r?I(document.body).find(".bb-message-dropdown-notification .bb-member-unread-count-span-"+e.user_id+" span.count").text(r):I(document.body).find(".bb-message-dropdown-notification .bb-member-unread-count-span-"+e.user_id+" span.count").length&&0===r?I(document.body).find(".bb-message-dropdown-notification .bb-member-unread-count-span-"+e.user_id+" span.count").remove():0===I(document.body).find(".bb-message-dropdown-notification .bb-member-unread-count-span-"+e.user_id+" span.count").length&&0<r&&I(document.body).find(".bb-message-dropdown-notification .bb-member-unread-count-span-"+e.user_id).append('<span class="count">'+r+"</span>")),I(document.body).find(".bp-buddypanel-menu-item-messages-count-"+e.user_id).length&&0<r&&I(document.body).find(".bp-buddypanel-menu-item-messages-count-"+e.user_id).each(function(){I(this).find(".bb-messages-inbox-unread-count").length?I(this).find(".bb-messages-inbox-unread-count").text(r).removeClass("bp-hide"):I(this).find("> a").append('<span class="count bb-messages-inbox-unread-count">'+r+"</span>")}))})},UpdateThreadListing:function(e,r){var s;e&&(s=!1,e.forEach(function(e){I(document.body).find(".bp-messages-container").length&&I(document.body).find(".bp-messages-container .bp-messages-threads-list").length&&I(document.body).find(".bp-messages-container .bp-messages-threads-list-user-"+e.user_id).length&&void 0!==window.Backbone.trigger&&!1===s&&(window.Backbone.trigger("relistelements",r),s=!0)}))},bb_update_header_messages:function(){if(I(document.body).find("#header-messages-dropdown-elem").length){if(bp.Pusher_FrontCommon.xhr)return;I(document.body).find("#header-messages-dropdown-elem ul.notification-list").html('<p class="bb-header-loader"><i class="bb-icon-loader animate-spin"></i></p>'),bp.Pusher_FrontCommon.xhr=I.get(ajaxurl,{action:"buddyboss_theme_get_header_unread_messages"},function(e){e.success&&void 0!==e.data&&void 0!==e.data.contents&&I("#header-messages-dropdown-elem ul.notification-list").length&&(I(document.body).find("#header-messages-dropdown-elem ul.notification-list").html(e.data.contents),bp.Pusher_FrontCommon.xhr=!1)})}},presenceThreadMembers:function(){return bp.Pusher_FrontCommon.pusherPresenceThread},json2array:function(r){var s=[];return Object.keys(r).forEach(function(e){s.push(r[e])}),s},arrayIntersect:function(e,r){I(e).filter(r)},createCookie:function(e,r,s){var a,n="";s&&((a=new Date).setTime(a.getTime()+60*s*1e3),n="; expires="+a.toGMTString()),document.cookie=e+"="+r+n+"; path=/"},readCookie:function(e){for(var r=e+"=",s=document.cookie.split(";"),a=s.length,n=0;n<a;n++){for(var t=s[n];" "===t.charAt(0);)t=t.substring(1,t.length);if(0===t.indexOf(r))return t.substring(r.length,t.length)}return null},bbParseParams:function(e){function o(e,r,s){var a,n,t;-1!==(r+="").indexOf(".")?(n=r.split("."),a=r.split(/\.(.+)?/)[1],e[n[0]]||(e[n[0]]={}),""!==a&&o(e[n[0]],a,s)):-1!==r.indexOf("[")?(r=(n=r.split("["))[0],""==(t=(n=n[1].split("]"))[0])?((e=e||{})[r]&&I.isArray(e[r])||(e[r]=[]),e[r].push(s)):((e=e||{})[r]&&I.isArray(e[r])||(e[r]=[]),e[r][parseInt(t)]=s)):(e=e||{})[r]=s}""===(e+="")&&(e=window.location+"");var r,s={};if(e){if(-1!==e.indexOf("#")&&(e=e.substr(0,e.indexOf("#"))),-1===e.indexOf("?"))return{};if(""==(e=e.substr(e.indexOf("?")+1,e.length)))return;for(;r=a.exec(e);){o(s,n(r[1]),n(r[2]))}}return s},SHA1:function(e){function r(e,r){return e<<r|e>>>32-r}function s(e){for(var r="",s=7;0<=s;s--)r+=(e>>>4*s&15).toString(16);return r}for(var a,n,t,o,i,_,d,u,b=new Array(80),p=1732584193,h=4023233417,c=2562383102,g=271733878,m=3285377520,v=(e=function(e){e=e.replace(/\r\n/g,"\n");for(var r="",s=0;s<e.length;s++){var a=e.charCodeAt(s);a<128?r+=String.fromCharCode(a):(127<a&&a<2048?r+=String.fromCharCode(a>>6|192):(r+=String.fromCharCode(a>>12|224),r+=String.fromCharCode(a>>6&63|128)),r+=String.fromCharCode(63&a|128))}return r}(e)).length,l=[],w=0;w<v-3;w+=4)n=e.charCodeAt(w)<<24|e.charCodeAt(w+1)<<16|e.charCodeAt(w+2)<<8|e.charCodeAt(w+3),l.push(n);switch(v%4){case 0:w=2147483648;break;case 1:w=e.charCodeAt(v-1)<<24|8388608;break;case 2:w=e.charCodeAt(v-2)<<24|e.charCodeAt(v-1)<<16|32768;break;case 3:w=e.charCodeAt(v-3)<<24|e.charCodeAt(v-2)<<16|e.charCodeAt(v-1)<<8|128}for(l.push(w);l.length%16!=14;)l.push(0);for(l.push(v>>>29),l.push(v<<3&4294967295),a=0;a<l.length;a+=16){for(w=0;w<16;w++)b[w]=l[a+w];for(w=16;w<=79;w++)b[w]=r(b[w-3]^b[w-8]^b[w-14]^b[w-16],1);for(t=p,o=h,i=c,_=g,d=m,w=0;w<=19;w++)u=r(t,5)+(o&i|~o&_)+d+b[w]+1518500249&4294967295,d=_,_=i,i=r(o,30),o=t,t=u;for(w=20;w<=39;w++)u=r(t,5)+(o^i^_)+d+b[w]+1859775393&4294967295,d=_,_=i,i=r(o,30),o=t,t=u;for(w=40;w<=59;w++)u=r(t,5)+(o&i|o&_|i&_)+d+b[w]+2400959708&4294967295,d=_,_=i,i=r(o,30),o=t,t=u;for(w=60;w<=79;w++)u=r(t,5)+(o^i^_)+d+b[w]+3395469782&4294967295,d=_,_=i,i=r(o,30),o=t,t=u;p=p+t&4294967295,h=h+o&4294967295,c=c+i&4294967295,g=g+_&4294967295,m=m+d&4294967295}return(u=s(p)+s(h)+s(c)+s(g)+s(m)).toLowerCase()},triggerPusherChunked:function(e,r,s){var a=JSON.stringify(s),n=new Blob([a]).size,t=parseInt(bb_pusher_vars.content_size_limit),o=Math.ceil(n/t),i=Math.random();if(1<o)for(var _=1;_<=o;_++)e.trigger(r,{message_chunk_id:i,message_chunk_index:_-1,message_total_chunk:o,message_chunk:a.substr((_-1)*t,t),message_chunk_final:n<=t*_});else e.trigger(r,s)},bindWithPusherChunking:function(e,r,s){e.bind(r,s),e.bind("chunked-"+r,function(e){bp.Pusher_FrontCommon.chunks_event.hasOwnProperty(e.message_chunk_id)||(bp.Pusher_FrontCommon.chunks_event[e.message_chunk_id]={chunks:[]});var r=bp.Pusher_FrontCommon.chunks_event[e.message_chunk_id];r.chunks[e.message_chunk_index]=e.message_chunk,e.message_chunk_final&&r.chunks.length===e.message_total_chunk&&(s(JSON.parse(r.chunks.join(""))),delete bp.Pusher_FrontCommon.chunks_event[e.message_chunk_id])})},getWPCurrentTime:function(){var e=new Date,r=bb_pusher_vars.wp_offset,s=60*(e.getTimezoneOffset()+60*r)*1e3;e.setTime(e.getTime()+s);var a=e.getHours(),n=e.getMinutes(),t=12<=a?bb_pusher_vars.i18n.post_meridiem:bb_pusher_vars.i18n.ante_meridiem;return n<10&&(n="0"+n),(a=(a%=12)||12)+":"+n+" "+t}};var a=/([^&=]+)=?([^&]*)/g,n=function(e){return decodeURIComponent(e.replace(/\+/g," "))};bp.Pusher_FrontCommon.start()}((bp,jQuery));